/*! For license information please see app.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={255:(t,e,r)=>{r.d(e,{A:()=>n});const n={BASE_URL:"https://story-api.dicoding.dev/v1",CACHE_NAME:"StoryApp-v1",DATABASE_NAME:"story-app-database",DATABASE_VERSION:1,OBJECT_STORE_NAME:"stories",VAPID_PUBLIC_KEY:"BEl62iUYgUivxIkv69yViEuiBIa40HI80v-eBqkGJs1N7yXBvZOWsgsjWKuOaPhO-sjZO2gBB6j_bfuD3Id5aqI"}},275:(t,e,r)=>{r.r(e),r.d(e,{checkSubscriptionStatus:()=>y,registerServiceWorker:()=>s,requestNotificationPermission:()=>l,restoreSubscription:()=>m,subscribeToPushNotifications:()=>f,unsubscribeFromPushNotifications:()=>p});var n=r(255);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(){i=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,i=Object.create(o.prototype),c=new T(n||[]);return a(i,"_invoke",{value:P(t,r,c)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",y="suspendedYield",v="executing",m="completed",g={};function w(){}function b(){}function x(){}var E={};f(E,s,(function(){return this}));var L=Object.getPrototypeOf,k=L&&L(L(A([])));k&&k!==r&&n.call(k,s)&&(E=k);var S=x.prototype=w.prototype=Object.create(E);function O(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(i,a,c,s){var u=p(t[i],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==o(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,s)}),(function(t){r("throw",t,c,s)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,s)}))}s(u.arg)}var i;a(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=_(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?m:y,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function _(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,_(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(o(e)+" is not iterable")}return b.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:b,configurable:!0}),b.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},O(j.prototype),f(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(S),f(S,l,"Generator"),f(S,s,(function(){return this})),f(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=A,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function a(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function c(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function c(t){a(i,n,o,c,s,"next",t)}function s(t){a(i,n,o,c,s,"throw",t)}c(void 0)}))}}var s=function(){var t=c(i().mark((function t(){var e;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("serviceWorker"in navigator)){t.next=13;break}return t.prev=1,t.next=4,navigator.serviceWorker.register("/sw.js");case 4:return e=t.sent,console.log("Service Worker registered successfully:",e),e.addEventListener("updatefound",(function(){var t=e.installing;t.addEventListener("statechange",(function(){"installed"===t.state&&navigator.serviceWorker.controller&&u()}))})),t.abrupt("return",e);case 10:t.prev=10,t.t0=t.catch(1),console.error("Service Worker registration failed:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,10]])})));return function(){return t.apply(this,arguments)}}(),u=function(){var t=document.createElement("div");t.className="update-notification",t.innerHTML='\n    <div class="update-content">\n      <p>New version available!</p>\n      <button onclick="window.location.reload()">Update Now</button>\n    </div>\n  ',document.body.appendChild(t),setTimeout((function(){t.parentNode&&t.parentNode.removeChild(t)}),1e4)},l=function(){var t=c(i().mark((function t(){var e;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("Notification"in window)){t.next=5;break}return t.next=3,Notification.requestPermission();case 3:return e=t.sent,t.abrupt("return","granted"===e);case 5:return t.abrupt("return",!1);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();function f(t){return h.apply(this,arguments)}function h(){return(h=c(i().mark((function t(e){var r,o,a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("Attempting to subscribe to push notifications..."),t.next=4,e.pushManager.getSubscription();case 4:if(!(r=t.sent)){t.next=8;break}return console.log("Already subscribed to push notifications"),t.abrupt("return",r);case 8:if(n.A.VAPID_PUBLIC_KEY){t.next=11;break}return console.error("VAPID public key not found in config"),t.abrupt("return",null);case 11:return console.log("VAPID public key found:",n.A.VAPID_PUBLIC_KEY.substring(0,20)+"..."),console.log("VAPID key length:",n.A.VAPID_PUBLIC_KEY.length),o=w(n.A.VAPID_PUBLIC_KEY),console.log("Converted VAPID key to Uint8Array, length:",o.length),t.next=17,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:o});case 17:return a=t.sent,console.log("Successfully subscribed to push notifications:",a),localStorage.setItem("pushSubscription",JSON.stringify(a)),t.abrupt("return",a);case 23:return t.prev=23,t.t0=t.catch(0),console.error("Error subscribing to push notifications:",t.t0),console.error("Error details:",{name:t.t0.name,message:t.t0.message,stack:t.t0.stack}),t.abrupt("return",null);case 28:case"end":return t.stop()}}),t,null,[[0,23]])})))).apply(this,arguments)}function p(t){return d.apply(this,arguments)}function d(){return(d=c(i().mark((function t(e){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("Attempting to unsubscribe from push notifications..."),t.next=4,e.pushManager.getSubscription();case 4:if(!(r=t.sent)){t.next=11;break}return t.next=8,r.unsubscribe();case 8:return localStorage.removeItem("pushSubscription"),console.log("Successfully unsubscribed from push notifications"),t.abrupt("return",!0);case 11:return console.log("No active subscription found"),t.abrupt("return",!1);case 15:return t.prev=15,t.t0=t.catch(0),console.error("Error unsubscribing from push notifications:",t.t0),t.abrupt("return",!1);case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))).apply(this,arguments)}function y(t){return v.apply(this,arguments)}function v(){return(v=c(i().mark((function t(e){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.pushManager.getSubscription();case 3:return r=t.sent,t.abrupt("return",{subscribed:!!r,subscription:r});case 7:return t.prev=7,t.t0=t.catch(0),console.error("Error checking subscription status:",t.t0),t.abrupt("return",{subscribed:!1,subscription:null});case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}function m(t){return g.apply(this,arguments)}function g(){return(g=c(i().mark((function t(e){var r,n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(r=localStorage.getItem("pushSubscription"))){t.next=6;break}return n=JSON.parse(r),console.log("Restoring subscription from localStorage"),t.abrupt("return",n);case 6:return t.abrupt("return",null);case 9:return t.prev=9,t.t0=t.catch(0),console.error("Error restoring subscription:",t.t0),t.abrupt("return",null);case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))).apply(this,arguments)}var w=function(t){try{for(var e=t.trim(),r=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(r),o=new Uint8Array(n.length),i=0;i<n.length;++i)o[i]=n.charCodeAt(i);return console.log("VAPID key converted successfully, length:",o.length),o}catch(t){throw console.error("Error converting VAPID key:",t),new Error("Invalid VAPID public key format")}}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n=r(255);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e,r){return(e=h(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(){s=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,a=Object.create(o.prototype),c=new T(n||[]);return i(a,"_invoke",{value:P(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",y="suspendedYield",v="executing",m="completed",g={};function w(){}function b(){}function x(){}var E={};f(E,c,(function(){return this}));var L=Object.getPrototypeOf,k=L&&L(L(A([])));k&&k!==r&&n.call(k,c)&&(E=k);var S=x.prototype=w.prototype=Object.create(E);function O(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(i,a,c,s){var u=p(t[i],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==o(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,s)}),(function(t){r("throw",t,c,s)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,s)}))}s(u.arg)}var a;i(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function P(e,r,n){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=_(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?m:y,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function _(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,_(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(o(e)+" is not iterable")}return b.prototype=x,i(S,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:b,configurable:!0}),b.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},O(j.prototype),f(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(S),f(S,l,"Generator"),f(S,c,(function(){return this})),f(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=A,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function u(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function l(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){u(i,n,o,a,c,"next",t)}function c(t){u(i,n,o,a,c,"throw",t)}a(void 0)}))}}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,h(n.key),n)}}function h(t){var e=function(t){if("object"!=o(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}function p(t,e){var r,n,o,i;if(t<=2){for(var a=arguments.length,c=new Array(a>2?a-2:0),s=2;s<a;s++)c[s-2]=arguments[s];switch(t){case 1:(r=console).error.apply(r,["[IndexedDB] ".concat(e)].concat(c));break;case 2:(n=console).warn.apply(n,["[IndexedDB] ".concat(e)].concat(c));break;case 3:(o=console).info.apply(o,["[IndexedDB] ".concat(e)].concat(c));break;case 4:(i=console).log.apply(i,["[IndexedDB] ".concat(e)].concat(c))}}}var d=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dbName=n.A.DATABASE_NAME,this.dbVersion=n.A.DATABASE_VERSION,this.objectStoreName=n.A.OBJECT_STORE_NAME,this.isInitialized=!1},e=[{key:"openDB",value:(S=l(s().mark((function t(){var e=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var n=indexedDB.open(e.dbName,e.dbVersion);n.onerror=function(){p(1,"Failed to open database:",n.error),r(new Error("Failed to open database"))},n.onsuccess=function(){e.isInitialized=!0,p(3,"Database opened successfully"),t(n.result)},n.onupgradeneeded=function(t){var r=t.target.result;if(p(3,"Database upgrade needed, version:",r.version),!r.objectStoreNames.contains(e.objectStoreName)){var n=r.createObjectStore(e.objectStoreName,{keyPath:"id",autoIncrement:!1});n.createIndex("title","title",{unique:!1}),n.createIndex("description","description",{unique:!1}),n.createIndex("createdAt","createdAt",{unique:!1}),n.createIndex("isOffline","isOffline",{unique:!1}),n.createIndex("syncedAt","syncedAt",{unique:!1}),n.createIndex("isSyncing","isSyncing",{unique:!1}),p(3,"Object store and indexes created successfully")}}})));case 1:case"end":return t.stop()}}),t)}))),function(){return S.apply(this,arguments)})},{key:"ensureInitialized",value:(k=l(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isInitialized){t.next=3;break}return t.next=3,this.openDB();case 3:case"end":return t.stop()}}),t,this)}))),function(){return k.apply(this,arguments)})},{key:"cacheStories",value:(L=l(s().mark((function t(e){var r,n=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureInitialized();case 2:return t.next=4,this.openDB();case 4:return r=t.sent,t.abrupt("return",new Promise((function(t,o){var i=r.transaction([n.objectStoreName],"readwrite").objectStore(n.objectStoreName),c=i.getAll();c.onsuccess=function(){var r=c.result;i.openCursor().onsuccess=function(c){var s=c.target.result;if(s){var u=s.value,l=u.syncedAt&&(new Date).getTime()-new Date(u.syncedAt).getTime()<3e5;u.isOffline||l||s.delete(),s.continue()}else{var f=0,h=e.length;if(0===h)return p(3,"No stories to cache"),void t();p(3,"Caching ".concat(h," stories for offline use")),e.forEach((function(c){var s=r.find((function(t){return t.id===c.id||t.description===c.description&&Math.abs(new Date(t.createdAt).getTime()-new Date(c.createdAt).getTime())<6e4}));if(s){var u=i.put(a(a(a({},s),c),{},{cachedAt:(new Date).toISOString(),isOffline:!1,isSyncing:!1,syncedAt:s.syncedAt||(new Date).toISOString(),syncMethod:s.syncMethod||"api_cache"}));u.onsuccess=function(){++f===h&&(n._preCacheStoryImages(e),p(3,"Successfully cached ".concat(f," stories")),t())},u.onerror=function(){p(1,"Failed to update existing story:",u.error),o(new Error("Failed to update existing story"))}}else{var l=i.put(a(a({},c),{},{cachedAt:(new Date).toISOString(),isOffline:!1,isSyncing:!1,syncedAt:(new Date).toISOString(),syncMethod:"api_cache"}));l.onsuccess=function(){++f===h&&(n._preCacheStoryImages(e),p(3,"Successfully cached ".concat(f," stories")),t())},l.onerror=function(){p(1,"Failed to cache story:",l.error),o(new Error("Failed to cache story"))}}}))}}},c.onerror=function(){p(1,"Failed to get existing stories:",c.error),o(new Error("Failed to get existing stories"))}})));case 6:case"end":return t.stop()}}),t,this)}))),function(t){return L.apply(this,arguments)})},{key:"_preCacheStoryImages",value:(E=l(s().mark((function t(e){var r,n,o,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,caches.open("StoryApp-Images-v1");case 3:return r=t.sent,n=0,o=0,i=e.filter((function(t){return t.photoUrl&&t.photoUrl.startsWith("https://")})).map(function(){var t=l(s().mark((function t(e){var i,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e.photoUrl);case 3:if(503!==(i=t.sent).status){t.next=7;break}return o++,t.abrupt("return");case 7:if(!i.ok){t.next=12;break}return a=i.clone(),t.next=11,r.put(e.photoUrl,a);case 11:n++;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),p(2,"Failed to pre-cache story image:",e.photoUrl,t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(e){return t.apply(this,arguments)}}()),t.next=9,Promise.allSettled(i);case 9:p(3,"IndexedDB story images pre-caching: ".concat(n," cached, ").concat(o," skipped (503)")),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),p(2,"Failed to pre-cache story images from IndexedDB:",t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])}))),function(t){return E.apply(this,arguments)})},{key:"getCachedStories",value:(x=l(s().mark((function t(){var e,r=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureInitialized();case 2:return t.next=4,this.openDB();case 4:return e=t.sent,t.abrupt("return",new Promise((function(t,n){var o=e.transaction([r.objectStoreName],"readonly").objectStore(r.objectStoreName).getAll();o.onsuccess=function(){var e=o.result;p(3,"Retrieved ".concat(e.length," cached stories from IndexedDB"));var n=e.sort((function(t,e){return new Date(e.createdAt)-new Date(t.createdAt)}));n.length>0&&r._preCacheStoryImages(n),t(n)},o.onerror=function(){p(1,"Failed to get cached stories:",o.error),n(new Error("Failed to get cached stories"))}})));case 6:case"end":return t.stop()}}),t,this)}))),function(){return x.apply(this,arguments)})},{key:"addOfflineStory",value:(b=l(s().mark((function t(e){var r,n=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return r=t.sent,t.abrupt("return",new Promise((function(t,o){var i=r.transaction([n.objectStoreName],"readwrite").objectStore(n.objectStoreName),c=Date.now(),s=Math.random().toString(36).substr(2,9),u="offline_".concat(c,"_").concat(s),l=i.add(a(a({},e),{},{id:u,originalId:e.id||null,createdAt:(new Date).toISOString(),isOffline:!0,syncAttempts:0,lastSyncAttempt:null}));l.onsuccess=function(){e.photoUrl&&n._preCacheStoryImages([e]),p(3,"Offline story added with ID:",u),t(l.result)},l.onerror=function(){o(new Error("Failed to add offline story"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return b.apply(this,arguments)})},{key:"checkDuplicateStory",value:(w=l(s().mark((function t(e){var r,n=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return r=t.sent,t.abrupt("return",new Promise((function(t,o){var i=r.transaction([n.objectStoreName],"readonly").objectStore(n.objectStoreName).getAll();i.onsuccess=function(){var r=i.result.find((function(t){return t.description===e.description&&!0===t.isOffline&&Math.abs(new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())<6e4}));t(r||null)},i.onerror=function(){o(new Error("Failed to check for duplicate story"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return w.apply(this,arguments)})},{key:"updateStory",value:(g=l(s().mark((function t(e,r){var n,o=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return n=t.sent,t.abrupt("return",new Promise((function(t,i){var c=n.transaction([o.objectStoreName],"readwrite").objectStore(o.objectStoreName),s=c.get(e);s.onsuccess=function(){var n=s.result;if(n){var o=a(a(a({},n),r),{},{updatedAt:(new Date).toISOString(),syncAttempts:(n.syncAttempts||0)+1});!1===r.isOffline&&r.id!==n.id&&(o.originalOfflineId=n.id,p(3,"Story synced: ".concat(n.id," -> ").concat(r.id)));var u=c.put(o);u.onsuccess=function(){p(3,"Story updated successfully:",e),t(u.result)},u.onerror=function(){i(new Error("Failed to update story"))}}else i(new Error("Story not found"))},s.onerror=function(){i(new Error("Failed to get story for update"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(t,e){return g.apply(this,arguments)})},{key:"deleteStory",value:(m=l(s().mark((function t(e){var r,n=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return r=t.sent,t.abrupt("return",new Promise((function(t,o){var i=r.transaction([n.objectStoreName],"readwrite").objectStore(n.objectStoreName).delete(e);i.onsuccess=function(){p(3,"Story deleted successfully:",e),t()},i.onerror=function(){o(new Error("Failed to delete story"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return m.apply(this,arguments)})},{key:"clearAllStories",value:(v=l(s().mark((function t(){var e,r=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return e=t.sent,t.abrupt("return",new Promise((function(t,n){var o=e.transaction([r.objectStoreName],"readwrite").objectStore(r.objectStoreName).clear();o.onsuccess=function(){p(3,"All stories cleared"),t()},o.onerror=function(){n(new Error("Failed to clear stories"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return v.apply(this,arguments)})},{key:"hasCachedData",value:(y=l(s().mark((function t(){var e,r=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return e=t.sent,t.abrupt("return",new Promise((function(t,n){var o=e.transaction([r.objectStoreName],"readonly").objectStore(r.objectStoreName).count();o.onsuccess=function(){t(o.result>0)},o.onerror=function(){n(new Error("Failed to check cached data"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return y.apply(this,arguments)})},{key:"resetStuckSyncingStories",value:(d=l(s().mark((function t(){var e,r=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return e=t.sent,t.abrupt("return",new Promise((function(t,n){var o=e.transaction([r.objectStoreName],"readwrite").objectStore(r.objectStoreName).openCursor(),i=0;o.onsuccess=function(e){var r=e.target.result;if(r){var n=r.value;if(n.isSyncing&&n.syncStartedAt){var o=new Date(n.syncStartedAt).getTime();if((new Date).getTime()-o>3e5){var c=a(a({},n),{},{isSyncing:!1,syncStartedAt:null});r.update(c),i++}}r.continue()}else i>0&&p(3,"Reset ".concat(i," stuck syncing stories")),t(i)},o.onerror=function(){n(new Error("Failed to reset stuck syncing stories"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)})},{key:"cleanupFailedSyncStories",value:(h=l(s().mark((function t(){var e,r=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return e=t.sent,t.abrupt("return",new Promise((function(t,n){var o=e.transaction([r.objectStoreName],"readwrite").objectStore(r.objectStoreName).openCursor(),i=0;o.onsuccess=function(e){var r=e.target.result;if(r){var n=r.value;if(n.syncFailed&&n.lastSyncAttempt){var o=new Date(n.lastSyncAttempt).getTime();(new Date).getTime()-o>36e5&&(r.delete(),i++)}r.continue()}else i>0&&p(3,"Cleaned up ".concat(i," permanently failed sync stories")),t(i)},o.onerror=function(){n(new Error("Failed to cleanup failed sync stories"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return h.apply(this,arguments)})},{key:"getCacheStats",value:(u=l(s().mark((function t(){var e,r=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return e=t.sent,t.abrupt("return",new Promise((function(t,n){var o=e.transaction([r.objectStoreName],"readonly").objectStore(r.objectStoreName).getAll();o.onsuccess=function(){var e=o.result,r=e.filter((function(t){return!0===t.isOffline&&!t.isSyncing&&!t.syncedAt&&!t.syncFailed})),n=e.filter((function(t){return!t.isOffline})),i=e.filter((function(t){return t.isSyncing})),a=e.filter((function(t){return t.syncFailed}));t({total:e.length,offline:r.length,cached:n.length,syncing:i.length,failed:a.length})},o.onerror=function(){n(new Error("Failed to get cache stats"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"getOfflineStories",value:(c=l(s().mark((function t(){var e,r=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return e=t.sent,t.abrupt("return",new Promise((function(t,n){var o=e.transaction([r.objectStoreName],"readonly").objectStore(r.objectStoreName).getAll();o.onsuccess=function(){var e=o.result,r=e.filter((function(t){return!0===t.isOffline&&!t.isSyncing&&!t.syncedAt&&!t.syncFailed}));p(3,"Found ".concat(r.length," offline stories out of ").concat(e.length," total")),t(r)},o.onerror=function(){n(new Error("Failed to get offline stories"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"getStoryById",value:(i=l(s().mark((function t(e){var r,n=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return r=t.sent,t.abrupt("return",new Promise((function(t,o){var i=r.transaction([n.objectStoreName],"readonly").objectStore(n.objectStoreName).get(e);i.onsuccess=function(){t(i.result)},i.onerror=function(){o(new Error("Failed to get story by ID"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"cleanupSyncedStories",value:(o=l(s().mark((function t(){var e,r=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return e=t.sent,t.abrupt("return",new Promise((function(t,n){var o=e.transaction([r.objectStoreName],"readwrite").objectStore(r.objectStoreName).openCursor(),i=0;o.onsuccess=function(e){var r=e.target.result;if(r){var n=r.value;if(n.syncedAt&&!n.isOffline){var o=new Date(n.syncedAt).getTime();(new Date).getTime()-o>6e5&&(r.delete(),i++)}r.continue()}else p(3,"Cleaned up ".concat(i," old synced stories")),t(i)},o.onerror=function(){n(new Error("Failed to cleanup synced stories"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"getAllStories",value:(r=l(s().mark((function t(){var e,r=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openDB();case 2:return e=t.sent,t.abrupt("return",new Promise((function(t,n){var o=e.transaction([r.objectStoreName],"readonly").objectStore(r.objectStoreName).getAll();o.onsuccess=function(){t(o.result)},o.onerror=function(){n(new Error("Failed to get all stories"))}})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})}],e&&f(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,o,i,c,u,h,d,y,v,m,g,w,b,x,E,L,k,S}();const y=d;function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function g(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?m(Object(r),!0).forEach((function(e){w(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function w(t,e,r){return(e=function(t){var e=function(t){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function b(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=x(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function x(t,e){if(t){if("string"==typeof t)return E(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(t,e):void 0}}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function k(){k=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function g(){}function w(){}function b(){}var x={};u(x,a,(function(){return this}));var E=Object.getPrototypeOf,L=E&&E(E(A([])));L&&L!==r&&n.call(L,a)&&(x=L);var S=b.prototype=g.prototype=Object.create(x);function O(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==v(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=_(c,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function _(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,_(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(v(e)+" is not iterable")}return w.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:w,configurable:!0}),w.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},O(j.prototype),u(j.prototype,c,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(S),u(S,s,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=A,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function S(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function O(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){S(i,n,o,a,c,"next",t)}function c(t){S(i,n,o,a,c,"throw",t)}a(void 0)}))}}var j={REGISTER:"".concat(n.A.BASE_URL,"/register"),LOGIN:"".concat(n.A.BASE_URL,"/login"),STORY:"".concat(n.A.BASE_URL,"/stories"),STORIES:"".concat(n.A.BASE_URL,"/stories"),DETAIL:function(t){return"".concat(n.A.BASE_URL,"/stories/").concat(t)}},P=new y,_=function(){var t=localStorage.getItem("token");if(!t)throw new Error("No authentication token found. Please login first.");return t},N=function(){var t=O(k().mark((function t(e){var r;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.json();case 2:if(r=t.sent,e.ok){t.next=5;break}throw new Error(r.message||"Request failed with status ".concat(e.status));case 5:return t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),I=function(){document.dispatchEvent(new Event("authStateChanged"))};function T(t){return A.apply(this,arguments)}function A(){return(A=O(k().mark((function t(e){var r,n,o,i,a;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.name,n=e.email,o=e.password,t.prev=1,t.next=4,fetch(j.REGISTER,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({name:r,email:n,password:o})});case 4:if(i=t.sent,(a=i.headers.get("content-type"))&&a.includes("application/json")){t.next=13;break}return t.next=9,i.text();case 9:if(!t.sent.includes("Offline")){t.next=12;break}throw new Error("No internet connection. Please check your connection and try again.");case 12:throw new Error("Server returned invalid response format. Please try again.");case 13:return t.next=15,N(i);case 15:return t.abrupt("return",t.sent);case 18:if(t.prev=18,t.t0=t.catch(1),console.error("Error during registration:",t.t0),!t.t0.message.includes("No internet connection")){t.next=23;break}throw new Error("No internet connection. Please check your connection and try again.");case 23:throw new Error(t.t0.message||"Failed to register. Please check your internet connection.");case 24:case"end":return t.stop()}}),t,null,[[1,18]])})))).apply(this,arguments)}function F(t){return C.apply(this,arguments)}function C(){return(C=O(k().mark((function t(e){var r,n,o,i,a,c,s;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.email,n=e.password,o=window.matchMedia("(display-mode: standalone)").matches||window.matchMedia("(display-mode: window-controls-overlay)").matches||window.matchMedia("(display-mode: minimal-ui)").matches||!0===window.navigator.standalone,console.log("üîê Login attempt - PWA Mode: ".concat(o,", Online: ").concat(navigator.onLine)),t.prev=3,t.next=6,fetch(j.LOGIN,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:r,password:n})});case 6:if(i=t.sent,console.log("üì° Login response - Status: ".concat(i.status,", Type: ").concat(i.type,", URL: ").concat(i.url)),a=i.headers.get("content-type"),console.log("üìã Response content-type: ".concat(a)),a&&a.includes("application/json")){t.next=18;break}return t.next=13,i.text();case 13:if(c=t.sent,console.error("‚ùå Non-JSON response received: ".concat(c.substring(0,100),"...")),!c.includes("Offline")){t.next=17;break}throw new Error("No internet connection. Please check your connection and try again.");case 17:throw new Error("Server returned invalid response format. Please try again.");case 18:return t.next=20,i.json();case 20:if(s=t.sent,console.log("‚úÖ Login response parsed successfully:",{hasLoginResult:!!s.loginResult,hasToken:!(!s.loginResult||!s.loginResult.token),pwaMode:o}),i.ok){t.next=24;break}throw new Error(s.message||"Login failed");case 24:return s.loginResult&&s.loginResult.token&&(localStorage.setItem("token",s.loginResult.token),localStorage.setItem("user",JSON.stringify(s.loginResult)),I(),console.log("üéâ Login successful - Token stored, PWA Mode: ".concat(o))),t.abrupt("return",s);case 28:if(t.prev=28,t.t0=t.catch(3),console.error("‚ùå Login error - PWA Mode: ".concat(o,", Error:"),t.t0),!t.t0.message.includes("Failed to fetch")){t.next=33;break}throw new Error("Network error. Please check your internet connection.");case 33:if(!t.t0.message.includes("No internet connection")){t.next=35;break}throw new Error("No internet connection. Please check your connection and try again.");case 35:throw new Error(t.t0.message||"Failed to login. Please check your credentials.");case 36:case"end":return t.stop()}}),t,null,[[3,28]])})))).apply(this,arguments)}var G=function(){var t=O(k().mark((function t(e){var r,n,o,i,a,c,s;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!navigator.onLine){t.next=20;break}return t.prev=2,t.next=5,fetch(j.STORY,{method:"POST",headers:{Authorization:"Bearer ".concat(_())},body:e});case 5:return r=t.sent,t.next=8,r.json();case 8:if(n=t.sent,r.ok){t.next=11;break}throw new Error(n.message||"Failed to add story");case 11:if(!n.story){t.next=14;break}return t.next=14,P.cacheStories([n.story]);case 14:return t.abrupt("return",n);case 17:t.prev=17,t.t0=t.catch(2),console.warn("API failed, saving story offline:",t.t0);case 20:if(o={description:e.get("description"),photoUrl:null,lat:e.get("lat")||null,lon:e.get("lon")||null,createdAt:(new Date).toISOString(),isOffline:!0},!((i=e.get("photo"))&&i instanceof File)){t.next=36;break}return t.prev=23,t.next=26,i.arrayBuffer();case 26:a=t.sent,c=btoa(String.fromCharCode.apply(String,function(t){if(Array.isArray(t))return E(t)}(u=new Uint8Array(a))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(u)||x(u)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),o.photoUrl="data:".concat(i.type,";base64,").concat(c),o.photoType=i.type,o.photoName=i.name,t.next=36;break;case 33:t.prev=33,t.t1=t.catch(23),console.warn("Failed to convert photo to base64:",t.t1);case 36:return t.prev=36,t.next=39,P.checkDuplicateStory(o);case 39:if(!(s=t.sent)){t.next=43;break}return console.log("Duplicate story detected, skipping save:",s.id),t.abrupt("return",{story:s,error:"duplicate",message:"Story already exists offline."});case 43:t.next=48;break;case 45:t.prev=45,t.t2=t.catch(36),console.warn("Failed to check for duplicate:",t.t2);case 48:return t.next=50,P.addOfflineStory(o);case 50:return console.log("Story saved offline with unique ID:",o.id),t.abrupt("return",{story:o,error:"offline",message:"Story saved offline. It will be synced when you go online."});case 54:throw t.prev=54,t.t3=t.catch(0),console.error("Error adding story:",t.t3),new Error(t.t3.message||"An error occurred while adding story");case 58:case"end":return t.stop()}var u}),t,null,[[0,54],[2,17],[23,33],[36,45]])})));return function(e){return t.apply(this,arguments)}}();function B(){return D.apply(this,arguments)}function D(){return(D=O(k().mark((function t(){var e,r,n,o,i;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!navigator.onLine){t.next=36;break}if(sessionStorage.getItem("isSyncingOfflineStories")){t.next=18;break}return t.prev=4,sessionStorage.setItem("isSyncingOfflineStories","true"),t.next=8,M();case 8:e=t.sent,console.log("Sync result:",e),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),console.warn("Failed to sync offline stories:",t.t0);case 15:return t.prev=15,sessionStorage.removeItem("isSyncingOfflineStories"),t.finish(15);case 18:return t.prev=18,r=_(),t.next=22,fetch(j.STORIES,{method:"GET",headers:{Authorization:"Bearer ".concat(r),Accept:"application/json"}});case 22:return n=t.sent,t.next=25,N(n);case 25:if(!((o=t.sent).listStory&&o.listStory.length>0)){t.next=29;break}return t.next=29,P.cacheStories(o.listStory);case 29:return console.log("üì± Fetched ".concat(o.listStory.length," stories from API")),t.abrupt("return",o);case 33:t.prev=33,t.t1=t.catch(18),console.log("API failed, trying cached data:",t.t1);case 36:return t.next=38,P.getCachedStories();case 38:if(!((i=t.sent).length>0)){t.next=42;break}return console.log("üì± Showing ".concat(i.length," cached stories (offline mode)")),t.abrupt("return",{listStory:i,error:"offline",message:"Showing cached stories. Some features may be limited."});case 42:throw new Error("No stories available offline. Please check your internet connection.");case 45:throw t.prev=45,t.t2=t.catch(0),console.error("Error fetching stories:",t.t2),new Error(t.t2.message||"Failed to fetch stories. Please check your internet connection.");case 49:case"end":return t.stop()}}),t,null,[[0,45],[4,12,15,18],[18,33]])})))).apply(this,arguments)}function M(){return R.apply(this,arguments)}function R(){return(R=O(k().mark((function t(){var e,r,n,o,i,a,c,s,u,l,f,h,p,d,y,v,m,w,x,E,L,S;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.prev=1,t.next=4,P.resetStuckSyncingStories();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),console.warn("Failed to reset stuck syncing stories:",t.t0);case 9:return t.prev=9,t.next=12,P.cleanupFailedSyncStories();case 12:t.next=17;break;case 14:t.prev=14,t.t1=t.catch(9),console.warn("Failed to cleanup failed sync stories:",t.t1);case 17:return t.next=19,P.getOfflineStories();case 19:if(0!==(e=t.sent).length){t.next=22;break}return t.abrupt("return",{synced:0,failed:0,skipped:0});case 22:console.log("Syncing ".concat(e.length," offline stories to API...")),r=0,n=0,o=0,i=b(e),t.prev=27,i.s();case 29:if((a=i.n()).done){t.next=156;break}if(c=a.value,t.prev=31,!c.isSyncing&&!c.syncedAt){t.next=36;break}return console.log("Skipping already synced story:",c.id),o++,t.abrupt("continue",154);case 36:return t.next=38,U(c);case 38:if(!t.sent){t.next=45;break}return console.log("Story already exists in API, marking as synced:",c.id),t.next=43,P.updateStory(c.id,g(g({},c),{},{isOffline:!1,isSyncing:!1,syncedAt:(new Date).toISOString(),syncMethod:"detected_existing"}));case 43:return o++,t.abrupt("continue",154);case 45:return t.next=47,P.updateStory(c.id,g(g({},c),{},{isSyncing:!0,syncStartedAt:(new Date).toISOString()}));case 47:if((s=new FormData).append("description",c.description),!c.photoUrl){t.next=112;break}if(t.prev=51,!c.photoUrl.startsWith("data:")){t.next=72;break}return t.prev=53,t.next=56,fetch(c.photoUrl);case 56:return u=t.sent,t.next=59,u.blob();case 59:l=t.sent,f=c.photoName||"story-photo.jpg",h=c.photoType||l.type||"image/jpeg",p=new File([l],f,{type:h}),s.append("photo",p),t.next=70;break;case 67:t.prev=67,t.t2=t.catch(53),console.warn("Failed to convert base64 to file for story:",c.id,t.t2);case 70:t.next=107;break;case 72:if(!c.photoUrl.startsWith("blob:")){t.next=94;break}return t.prev=73,t.next=76,fetch(c.photoUrl);case 76:if(!(d=t.sent).ok){t.next=86;break}return t.next=80,d.blob();case 80:y=t.sent,v=new File([y],"story-photo.jpg",{type:y.type}),s.append("photo",v),t.next=87;break;case 86:console.warn("Blob URL not accessible for story:",c.id);case 87:t.next=92;break;case 89:t.prev=89,t.t3=t.catch(73),console.warn("Failed to access blob URL for story:",c.id,t.t3);case 92:t.next=107;break;case 94:return t.next=96,fetch(c.photoUrl);case 96:if(!(m=t.sent).ok){t.next=106;break}return t.next=100,m.blob();case 100:w=t.sent,x=new File([w],"story-photo.jpg",{type:w.type}),s.append("photo",x),t.next=107;break;case 106:console.warn("Photo URL not accessible for story:",c.id);case 107:t.next=112;break;case 109:t.prev=109,t.t4=t.catch(51),console.warn("Failed to process photo for story:",c.id,t.t4);case 112:return c.lat&&c.lon&&(s.append("lat",c.lat),s.append("lon",c.lon)),t.next=115,fetch(j.STORY,{method:"POST",headers:{Authorization:"Bearer ".concat(_())},body:s});case 115:if(!(E=t.sent).ok){t.next=126;break}return t.next=119,E.json();case 119:return L=t.sent,console.log("Successfully synced offline story:",L),t.next=123,P.updateStory(c.id,g(g({},c),{},{id:L.story.id,isOffline:!1,isSyncing:!1,syncedAt:(new Date).toISOString(),syncStartedAt:null,syncMethod:"api_sync"}));case 123:r++,t.next=140;break;case 126:return t.next=128,E.text();case 128:if(S=t.sent,console.error("Failed to sync story:",c.id,E.status,S),503!==E.status){t.next=137;break}return console.log("Server unavailable (503), will retry later for story:",c.id),t.next=134,P.updateStory(c.id,g(g({},c),{},{isSyncing:!1,syncStartedAt:null,lastSyncAttempt:(new Date).toISOString()}));case 134:o++,t.next=140;break;case 137:return t.next=139,P.updateStory(c.id,g(g({},c),{},{isSyncing:!1,syncStartedAt:null,syncFailed:!0,syncError:"".concat(E.status,": ").concat(S),lastSyncAttempt:(new Date).toISOString()}));case 139:n++;case 140:t.next=154;break;case 142:return t.prev=142,t.t5=t.catch(31),console.error("Error syncing story:",c.id,t.t5),t.prev=145,t.next=148,P.updateStory(c.id,g(g({},c),{},{isSyncing:!1,syncStartedAt:null,syncFailed:!0,syncError:t.t5.message,lastSyncAttempt:(new Date).toISOString()}));case 148:t.next=153;break;case 150:t.prev=150,t.t6=t.catch(145),console.error("Failed to reset syncing flag:",t.t6);case 153:n++;case 154:t.next=29;break;case 156:t.next=161;break;case 158:t.prev=158,t.t7=t.catch(27),i.e(t.t7);case 161:return t.prev=161,i.f(),t.finish(161);case 164:if(console.log("Sync completed: ".concat(r," synced, ").concat(n," failed, ").concat(o," skipped")),!(r>0)){t.next=174;break}return t.prev=166,t.next=169,P.cleanupSyncedStories();case 169:t.next=174;break;case 171:t.prev=171,t.t8=t.catch(166),console.warn("Failed to cleanup synced stories:",t.t8);case 174:return t.abrupt("return",{synced:r,failed:n,skipped:o});case 177:throw t.prev=177,t.t9=t.catch(0),console.error("Error during offline sync:",t.t9),t.t9;case 181:case"end":return t.stop()}}),t,null,[[0,177],[1,6],[9,14],[27,158,161,164],[31,142],[51,109],[53,67],[73,89],[145,150],[166,171]])})))).apply(this,arguments)}function U(t){return Y.apply(this,arguments)}function Y(){return(Y=O(k().mark((function t(e){var r,n,o,i,a;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=_(),t.next=4,fetch(j.STORIES,{method:"GET",headers:{Authorization:"Bearer ".concat(r),Accept:"application/json"}});case 4:if(!(n=t.sent).ok){t.next=14;break}return t.next=8,n.json();case 8:if(o=t.sent,i=o.listStory||[],!(a=i.find((function(t){if(t.description!==e.description)return!1;if(e.lat&&e.lon){if(!t.lat||!t.lon)return!1;var r=Math.abs(parseFloat(t.lat)-parseFloat(e.lat)),n=Math.abs(parseFloat(t.lon)-parseFloat(e.lon));if(r>1e-4||n>1e-4)return!1}var o=new Date(e.createdAt).getTime(),i=new Date(t.createdAt).getTime();return Math.abs(o-i)<3e5})))){t.next=14;break}return console.log("Found matching story in API:",a.id,"for offline story:",e.id),t.abrupt("return",!0);case 14:return t.abrupt("return",!1);case 17:return t.prev=17,t.t0=t.catch(0),console.warn("Failed to check if story exists in API:",t.t0),t.abrupt("return",!1);case 21:case"end":return t.stop()}}),t,null,[[0,17]])})))).apply(this,arguments)}function z(t){return H.apply(this,arguments)}function H(){return(H=O(k().mark((function t(e){var r,n,o,i;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!navigator.onLine){t.next=19;break}return t.prev=2,r=_(),t.next=6,fetch(j.DETAIL(e),{method:"GET",headers:{Authorization:"Bearer ".concat(r),Accept:"application/json"}});case 6:return n=t.sent,t.next=9,N(n);case 9:if(!(o=t.sent).story){t.next=13;break}return t.next=13,P.cacheStories([o.story]);case 13:return t.abrupt("return",o);case 16:t.prev=16,t.t0=t.catch(2),console.log("API failed, trying cached data:",t.t0);case 19:return t.next=21,P.getStoryById(e);case 21:if(!(i=t.sent)){t.next=24;break}return t.abrupt("return",{story:i,error:"offline",message:"Showing cached story. Some features may be limited."});case 24:throw new Error("Story not available offline. Please check your internet connection.");case 27:throw t.prev=27,t.t1=t.catch(0),console.error("Error fetching story detail:",t.t1),new Error(t.t1.message||"Failed to fetch story detail. Please check your internet connection.");case 31:case"end":return t.stop()}}),t,null,[[0,27],[2,16]])})))).apply(this,arguments)}var q=function(){return!!localStorage.getItem("token")};function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(t)}function V(){V=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==W(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(W(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function J(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function K(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){J(i,n,o,a,c,"next",t)}function c(t){J(i,n,o,a,c,"throw",t)}a(void 0)}))}}function X(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Z(n.key),n)}}function Z(t){var e=function(t){if("object"!=W(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=W(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==W(e)?e:e+""}var $=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.map=r,this.stories=[],this.db=new y},e=[{key:"loadStories",value:(o=K(V().mark((function t(){var e;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.view.showLoading(),t.next=4,B();case 4:return e=t.sent,this.stories=e.listStory||[],this.view.updateStoriesList(this.stories),this.view.updateMapMarkers(this.stories),t.next=10,this.logSyncStatus();case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Error loading stories:",t.t0),this.view.showError(t.t0.message);case 16:case"end":return t.stop()}}),t,this,[[0,12]])}))),function(){return o.apply(this,arguments)})},{key:"logSyncStatus",value:(n=K(V().mark((function t(){var e,r,n;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.db.getCacheStats();case 3:return e=t.sent,console.log("üìä Cache Status:",{total:e.total,offline:e.offline,cached:e.cached,syncing:e.syncing,failed:e.failed}),e.offline>0&&console.log("üì± ".concat(e.offline," offline stories will be synced automatically when online")),e.syncing>0&&console.log("‚è≥ ".concat(e.syncing," stories are currently syncing")),e.failed>0&&console.log("‚ùå ".concat(e.failed," stories failed to sync permanently")),t.prev=8,t.next=11,this.db.getAllStories();case 11:r=t.sent,n={},r.forEach((function(t){t.syncMethod&&(n[t.syncMethod]=(n[t.syncMethod]||0)+1)})),Object.keys(n).length>0&&console.log("üîÑ Sync Methods:",n),t.next=19;break;case 17:t.prev=17,t.t0=t.catch(8);case 19:t.next=24;break;case 21:t.prev=21,t.t1=t.catch(0),console.error("Failed to get cache stats:",t.t1);case 24:case"end":return t.stop()}}),t,this,[[0,21],[8,17]])}))),function(){return n.apply(this,arguments)})},{key:"handleStoryClick",value:function(t){window.location.hash="#/detail?id=".concat(t)}},{key:"afterRender",value:(r=K(V().mark((function t(){return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.map.initialize("story-map",{clickable:!1}),t.next=3,this.loadStories();case 3:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})}],e&&X(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o}();const Q=$;function tt(t){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tt(t)}function et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,rt(n.key),n)}}function rt(t){var e=function(t){if("object"!=tt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=tt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tt(e)?e:e+""}const nt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.map=null,this.marker=null,this.markers=[],this.markerChangeCallback=null,this.defaultLocation=[-6.2088,106.8456],this.defaultZoom=13},e=[{key:"initialize",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{this.map&&this.cleanup();var n=document.getElementById(t);if(!n)throw new Error('Map container with id "'.concat(t,'" not found'));n.innerHTML="",this.map=L.map(t).setView(this.defaultLocation,this.defaultZoom),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors"}).addTo(this.map),!1!==r.clickable&&this.map.on("click",(function(t){var r=t.latlng,n=r.lat,o=r.lng;e.marker?e.marker.setLatLng([n,o]):e.marker=L.marker([n,o]).addTo(e.map),e.markerChangeCallback&&e.markerChangeCallback({latitude:n,longitude:o})}))}catch(t){throw console.error("Error initializing map:",t),this.cleanup(),t}}},{key:"onMarkerChange",value:function(t){this.markerChangeCallback=t}},{key:"getMarkerLocation",value:function(){if(this.marker){var t=this.marker.getLatLng();return{latitude:t.lat,longitude:t.lng}}return null}},{key:"setMarkerLocation",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.map)return null;var n=L.marker([t,e]).addTo(this.map);return r&&n.bindPopup(r),this.markers.push(n),n}},{key:"clearMarkers",value:function(){var t=this;this.markers.forEach((function(e){t.map&&t.map.removeLayer(e)})),this.markers=[]}},{key:"clearMarker",value:function(){this.marker&&(this.map.removeLayer(this.marker),this.marker=null)}},{key:"fitBounds",value:function(){if(this.markers.length>0&&this.map){var t=L.featureGroup(this.markers);this.map.fitBounds(t.getBounds().pad(.1))}}},{key:"createCustomIcon",value:function(t){return L.icon({iconUrl:t,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]})}},{key:"cleanup",value:function(){try{this.map&&(this.clearMarkers(),this.clearMarker(),this.map.remove(),this.map=null),this.marker=null,this.markers=[],this.markerChangeCallback=null}catch(t){console.error("Error cleaning up map:",t)}}}],e&&et(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ot(t){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(t)}function it(){it=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==ot(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ot(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function at(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function ct(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){at(i,n,o,a,c,"next",t)}function c(t){at(i,n,o,a,c,"throw",t)}a(void 0)}))}}function st(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ut(n.key),n)}}function ut(t){var e=function(t){if("object"!=ot(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ot(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ot(e)?e:e+""}var lt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.map=new nt,this.presenter=new Q(this,this.map)},e=[{key:"render",value:(c=ct(it().mark((function t(){return it().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <section class="container">\n        \x3c!-- Welcome Section --\x3e\n        <div class="welcome-section">\n          <h1>Welcome to Story App</h1>\n          <p class="welcome-message">Share your stories and explore others\' experiences</p>\n        </div>\n\n        \x3c!-- Notification Subscription Section --\x3e\n        <div class="notification-section">\n          <div class="notification-content">\n            <div class="notification-icon">üì≤</div>\n            <div class="notification-text">\n              <h3>Get Notifications</h3>\n              <p>Stay updated with new stories and app updates</p>\n            </div>\n            <button id="subscribe-notifications" class="btn subscribe-btn">\n              <span class="btn-icon">üîî</span>\n              <span class="btn-text">Enable Notifications</span>\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- Action Buttons --\x3e\n        <div class="action-buttons">\n          <button id="view-stories" class="btn primary">View All Stories</button>\n          <a href="#/story/add" class="btn secondary">Add New Story</a>\n        </div>\n\n        \x3c!-- Map Section --\x3e\n        <div class="map-section">\n          <h2>Story Locations</h2>\n          <div id="story-map" style="height: 400px;"></div>\n        </div>\n\n        \x3c!-- Stories Section --\x3e\n        <div class="stories-section">\n          <h2>Latest Stories</h2>\n          <div id="story-list" class="story-list-container">\n            <div class="loader-container">\n              <div class="loader"></div>\n              <div class="loader-text">Loading stories...</div>\n            </div>\n          </div>\n        </div>\n      </section>\n    ');case 1:case"end":return t.stop()}}),t)}))),function(){return c.apply(this,arguments)})},{key:"afterRender",value:(a=ct(it().mark((function t(){return it().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.presenter.afterRender();case 2:return this.setupEventListeners(),t.next=5,this.checkSubscriptionStatus();case 5:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"checkSubscriptionStatus",value:(i=ct(it().mark((function t(){var e,n,o;return it().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!("serviceWorker"in navigator)||!("PushManager"in window)){t.next=13;break}return t.next=4,navigator.serviceWorker.ready;case 4:return e=t.sent,t.next=7,Promise.resolve().then(r.bind(r,275));case 7:return n=t.sent,o=n.checkSubscriptionStatus,t.next=11,o(e);case 11:t.sent.subscribed&&this.updateSubscribeButtonState("subscribed");case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),console.error("Error checking subscription status:",t.t0);case 18:case"end":return t.stop()}}),t,this,[[0,15]])}))),function(){return i.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var t=this;document.getElementById("view-stories").addEventListener("click",(function(){document.getElementById("story-list").scrollIntoView({behavior:"smooth"})}));var e=document.getElementById("subscribe-notifications");e&&e.addEventListener("click",(function(){t.handleNotificationSubscription()}));var r=document.getElementById("story-list");r.addEventListener("click",(function(e){var r=e.target.closest(".story-card");if(r){var n=r.dataset.storyId;n&&t.presenter.handleStoryClick(n)}})),r.addEventListener("keydown",(function(t){if("Enter"===t.key||" "===t.key){var e=t.target.closest(".story-card");e&&(t.preventDefault(),e.click())}}))}},{key:"handleNotificationSubscription",value:(o=ct(it().mark((function t(){var e;return it().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=document.getElementById("subscribe-notifications")){t.next=3;break}return t.abrupt("return");case 3:if(t.prev=3,e.disabled=!0,e.innerHTML='\n        <span class="btn-icon">‚è≥</span>\n        <span class="btn-text">Requesting Permission...</span>\n      ',"Notification"in window){t.next=9;break}return this.showNotificationMessage("Notifications are not supported in this browser","error"),t.abrupt("return");case 9:if("granted"!==Notification.permission){t.next=14;break}return t.next=12,this.subscribeToPushNotifications();case 12:t.next=27;break;case 14:if("denied"!==Notification.permission){t.next=18;break}this.showNotificationMessage("Notification permission was denied. Please enable it in your browser settings.","error"),t.next=27;break;case 18:return t.next=20,Notification.requestPermission();case 20:if("granted"!==t.sent){t.next=26;break}return t.next=24,this.subscribeToPushNotifications();case 24:t.next=27;break;case 26:this.showNotificationMessage("Notification permission denied","error");case 27:t.next=33;break;case 29:t.prev=29,t.t0=t.catch(3),console.error("Error handling notification subscription:",t.t0),this.showNotificationMessage("Failed to subscribe to notifications","error");case 33:return t.prev=33,this.resetSubscribeButton(),t.finish(33);case 36:case"end":return t.stop()}}),t,this,[[3,29,33,36]])}))),function(){return o.apply(this,arguments)})},{key:"subscribeToPushNotifications",value:(n=ct(it().mark((function t(){var e,n,o;return it().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.serviceWorker.ready;case 3:return e=t.sent,t.next=6,e.pushManager.getSubscription();case 6:if(!t.sent){t.next=10;break}return this.showNotificationMessage("Already subscribed to notifications!","success"),t.abrupt("return");case 10:return t.next=12,Promise.resolve().then(r.bind(r,275));case 12:return n=t.sent,o=n.subscribeToPushNotifications,t.next=16,o(e);case 16:t.sent?(this.showNotificationMessage("Successfully subscribed to notifications!","success"),this.updateSubscribeButtonState("subscribed")):this.showNotificationMessage("Failed to subscribe to notifications","error"),t.next=24;break;case 20:t.prev=20,t.t0=t.catch(0),console.error("Error subscribing to push notifications:",t.t0),this.showNotificationMessage("Failed to subscribe to notifications","error");case 24:case"end":return t.stop()}}),t,this,[[0,20]])}))),function(){return n.apply(this,arguments)})},{key:"showNotificationMessage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=document.querySelector(".notification-message");r&&r.remove();var n=document.createElement("div");n.className="notification-message notification-".concat(e),n.innerHTML='\n      <div class="notification-content">\n        <span class="notification-text">'.concat(t,'</span>\n        <button class="notification-close" onclick="this.parentElement.parentElement.remove()">√ó</button>\n      </div>\n    '),n.style.cssText="\n      position: fixed;\n      top: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      z-index: 1000;\n      padding: 15px 20px;\n      background-color: ".concat({success:"#4CAF50",error:"#f44336",info:"#2196F3"}[e],";\n      color: white;\n      border-radius: 5px;\n      box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n      font-size: 14px;\n      max-width: 400px;\n      animation: slideDown 0.3s ease-out;\n    "),document.body.appendChild(n),setTimeout((function(){n.parentNode&&n.parentNode.removeChild(n)}),5e3)}},{key:"updateSubscribeButtonState",value:function(t){var e=document.getElementById("subscribe-notifications");e&&"subscribed"===t&&(e.innerHTML='\n        <span class="btn-icon">‚úÖ</span>\n        <span class="btn-text">Subscribed!</span>\n      ',e.style.backgroundColor="#4CAF50",e.disabled=!0)}},{key:"resetSubscribeButton",value:function(){var t=document.getElementById("subscribe-notifications");t&&(t.disabled=!1,t.innerHTML='\n      <span class="btn-icon">üîî</span>\n      <span class="btn-text">Enable Notifications</span>\n    ',t.style.backgroundColor="")}},{key:"updateStoriesList",value:function(t){var e=document.getElementById("story-list");0===t.length?e.innerHTML='\n        <div class="empty-state">\n          <p>No stories available yet. Be the first to share your story!</p>\n        </div>\n      ':e.innerHTML=function(t){return t&&0!==t.length?'\n    <div class="story-list">\n      '.concat(t.map((function(t){return function(t){var e=new Date(t.createdAt).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return'\n    <div class="story-card" data-story-id="'.concat(t.id,'" role="button" tabindex="0">\n      <div class="story-image">\n        <img src="').concat(t.photoUrl,'" alt="').concat(t.name,'\' story" loading="lazy">\n      </div>\n      <div class="story-content">\n        <h3 class="story-name">').concat(t.name,'</h3>\n        <p class="story-description">').concat(t.description,'</p>\n        <div class="story-meta">\n          <span class="story-date">').concat(e,"</span>\n        </div>\n      </div>\n    </div>\n  ")}(t)})).join(""),"\n    </div>\n  "):'\n      <div class="empty-state">\n        <p>No stories available yet. Be the first to share your story!</p>\n      </div>\n    '}(t)}},{key:"showLoading",value:function(){document.getElementById("story-list").innerHTML='\n      <div class="loader-container">\n        <div class="loader"></div>\n        <div class="loader-text">Loading stories...</div>\n      </div>\n    '}},{key:"showError",value:function(t){document.getElementById("story-list").innerHTML='\n      <div class="error-state">\n        <p>Error: '.concat(t,'</p>\n        <button onclick="window.location.reload()">Try Again</button>\n      </div>\n    ')}},{key:"updateMapMarkers",value:function(t){var e=this;this.map.clearMarkers(),t.forEach((function(t){if(t.lat&&t.lon){var r='\n          <div class="story-popup">\n            <h3>'.concat(t.name,"</h3>\n            <p>").concat(t.description,"</p>\n            <small>Posted on: ").concat(new Date(t.createdAt).toLocaleDateString(),'</small>\n            <a href="#/detail?id=').concat(t.id,'" class="popup-link">View Details</a>\n          </div>\n        ');e.map.setMarkerLocation(t.lat,t.lon,r)}})),this.map.fitBounds()}}],e&&st(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o,i,a,c}();function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function ht(){ht=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==ft(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ft(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function pt(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function dt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){pt(i,n,o,a,c,"next",t)}function c(t){pt(i,n,o,a,c,"throw",t)}a(void 0)}))}}function yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vt(n.key),n)}}function vt(t){var e=function(t){if("object"!=ft(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ft(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ft(e)?e:e+""}const mt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.db=new y},e=[{key:"handleStorySubmit",value:(a=dt(ht().mark((function t(e){var r,n,o,i;return ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.description,n=e.imageBlob,o=e.latitude,i=e.longitude,t.prev=1,this.view.showLoading(!0),!navigator.onLine){t.next=8;break}return t.next=6,this.submitOnline(r,n,o,i);case 6:t.next=10;break;case 8:return t.next=10,this.saveOffline(r,n,o,i);case 10:t.next=28;break;case 12:if(t.prev=12,t.t0=t.catch(1),console.error("Error submitting story:",t.t0),!navigator.onLine){t.next=27;break}return t.prev=16,t.next=19,this.saveOffline(r,n,o,i);case 19:t.next=25;break;case 21:t.prev=21,t.t1=t.catch(16),console.error("Failed to save offline:",t.t1),this.view.showError("Failed to save story. Please try again when online.");case 25:t.next=28;break;case 27:this.view.showError(t.t0.message||"An error occurred while adding story");case 28:return t.prev=28,this.view.showLoading(!1),t.finish(28);case 31:case"end":return t.stop()}}),t,this,[[1,12,28,31],[16,21]])}))),function(t){return a.apply(this,arguments)})},{key:"submitOnline",value:(i=dt(ht().mark((function t(e,r,n,o){var i,a;return ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=new FormData).append("description",e),i.append("photo",r),n&&o&&(i.append("lat",n),i.append("lon",o)),t.next=6,G(i);case 6:if("success"!==(a=t.sent).status){t.next=12;break}return t.next=10,this.handleStorySuccess("Story added successfully!");case 10:t.next=13;break;case 12:throw new Error(a.message||"Failed to add story");case 13:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n){return i.apply(this,arguments)})},{key:"saveOffline",value:(o=dt(ht().mark((function t(e,r,n,o){var i,a;return ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.blobToBase64(r);case 2:return i=t.sent,a={title:e.substring(0,50)+(e.length>50?"...":""),description:e,photoUrl:i,latitude:n,longitude:o,isOffline:!0},t.next=6,this.db.addOfflineStory(a);case 6:return t.next=8,this.handleStorySuccess("Story saved offline! It will be synced when you're online.");case 8:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n){return o.apply(this,arguments)})},{key:"blobToBase64",value:(n=dt(ht().mark((function t(e){return ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var n=new FileReader;n.onload=function(){return t(n.result)},n.onerror=r,n.readAsDataURL(e)})));case 1:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})},{key:"handleStorySuccess",value:(r=dt(ht().mark((function t(e){return ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{this.view.showSuccess(e),window.location.replace("#/"),window.location.reload()}catch(t){console.error("Error during success handling:",t),window.location.href="#/"}case 1:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"cleanup",value:function(){}}],e&&yt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a}();function gt(t){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gt(t)}function wt(){wt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==gt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(gt(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function bt(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function xt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){bt(i,n,o,a,c,"next",t)}function c(t){bt(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Lt(n.key),n)}}function Lt(t){var e=function(t){if("object"!=gt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=gt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==gt(e)?e:e+""}const kt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.video=null,this.canvas=null,this.captureButton=null,this.resultImage=null,this.stream=null,this.selectCameraElement=null,this.devices=[],this.isInitialized=!1,this.boundCaptureImage=this.captureImage.bind(this),this.boundSwitchCamera=this.switchCamera.bind(this),this.boundHandleNavigation=this.handleNavigation.bind(this),this.lastCapturedBlob=null},e=[{key:"initialize",value:(c=xt(wt().mark((function t(){return wt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isInitialized){t.next=2;break}return t.abrupt("return");case 2:if(this.video=document.getElementById("camera-preview"),this.canvas=document.getElementById("camera-canvas"),this.captureButton=document.getElementById("camera-capture"),this.resultImage=document.getElementById("camera-result"),this.selectCameraElement=document.getElementById("camera-select"),this.video&&this.canvas&&this.captureButton&&this.resultImage&&this.selectCameraElement){t.next=10;break}return console.error("Required camera elements not found"),t.abrupt("return");case 10:return t.prev=10,t.next=13,this.getStream();case 13:if(this.stream=t.sent,!this.stream){t.next=23;break}return this.video.srcObject=this.stream,this.captureButton.addEventListener("click",this.boundCaptureImage),t.next=19,this.populateDeviceList();case 19:this.selectCameraElement.addEventListener("change",this.boundSwitchCamera),window.addEventListener("hashchange",this.boundHandleNavigation),document.addEventListener("story-submit",this.boundHandleNavigation),this.isInitialized=!0;case 23:t.next=29;break;case 25:t.prev=25,t.t0=t.catch(10),console.error("Error accessing camera:",t.t0),alert("Could not access camera. Please make sure you have granted camera permissions.");case 29:case"end":return t.stop()}}),t,this,[[10,25]])}))),function(){return c.apply(this,arguments)})},{key:"handleNavigation",value:function(){this.stopCamera()}},{key:"getStream",value:(a=xt(wt().mark((function t(){var e,r,n;return wt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=(null===(e=this.selectCameraElement)||void 0===e?void 0:e.value)||void 0,t.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:r?{exact:r}:void 0,width:{ideal:1280},height:{ideal:720}}});case 4:return n=t.sent,t.abrupt("return",n);case 8:return t.prev=8,t.t0=t.catch(0),console.error("Error getting stream:",t.t0),t.abrupt("return",null);case 12:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(){return a.apply(this,arguments)})},{key:"populateDeviceList",value:(i=xt(wt().mark((function t(){var e,r=this;return wt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.enumerateDevices();case 3:e=t.sent,this.devices=e.filter((function(t){return"videoinput"===t.kind})),this.selectCameraElement.innerHTML="",this.devices.forEach((function(t){var e=document.createElement("option");e.value=t.deviceId,e.text=t.label||"Camera ".concat(r.selectCameraElement.length+1),r.selectCameraElement.appendChild(e)})),this.selectCameraElement.style.display=this.devices.length>1?"block":"none",t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.error("Error populating device list:",t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])}))),function(){return i.apply(this,arguments)})},{key:"switchCamera",value:(o=xt(wt().mark((function t(){return wt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.stopCamera(),t.next=4,this.getStream();case 4:this.stream=t.sent,this.stream&&(this.video.srcObject=this.stream,this.isInitialized=!0),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("Error switching camera:",t.t0),alert("Failed to switch camera. Please try again.");case 12:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(){return o.apply(this,arguments)})},{key:"captureImage",value:(n=xt(wt().mark((function t(){var e=this;return wt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.video&&this.canvas){t.next=3;break}throw new Error("Camera not properly initialized");case 3:this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight,this.canvas.getContext("2d").drawImage(this.video,0,0,this.canvas.width,this.canvas.height),this.canvas.toBlob((function(t){if(t){e.lastCapturedBlob=t;var r=URL.createObjectURL(t);e.resultImage.src=r,e.resultImage.style.display="block",e.resultImage.dataset.previousUrl&&URL.revokeObjectURL(e.resultImage.dataset.previousUrl),e.resultImage.dataset.previousUrl=r}else console.error("Failed to create image blob"),alert("Failed to capture image. Please try again.")}),"image/jpeg",.8),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error("Error capturing image:",t.t0),alert("Failed to capture image. Please try again.");case 14:case"end":return t.stop()}}),t,this,[[0,10]])}))),function(){return n.apply(this,arguments)})},{key:"getImageBlob",value:(r=xt(wt().mark((function t(){return wt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.lastCapturedBlob);case 1:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"stopCamera",value:function(){this.stream&&(this.stream.getTracks().forEach((function(t){t.stop(),t.enabled=!1})),this.stream=null),this.video&&(this.video.srcObject=null,this.video.pause()),this.resultImage&&this.resultImage.dataset.previousUrl&&URL.revokeObjectURL(this.resultImage.dataset.previousUrl),this.lastCapturedBlob=null,this.isInitialized=!1}},{key:"cleanup",value:function(){this.stopCamera(),this.captureButton&&this.captureButton.removeEventListener("click",this.boundCaptureImage),this.selectCameraElement&&this.selectCameraElement.removeEventListener("change",this.boundSwitchCamera),window.removeEventListener("hashchange",this.boundHandleNavigation),document.removeEventListener("story-submit",this.boundHandleNavigation),this.video=null,this.canvas=null,this.captureButton=null,this.resultImage=null,this.selectCameraElement=null,this.devices=[]}}],e&&Et(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c}();function St(t){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},St(t)}function Ot(){Ot=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==St(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(St(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function jt(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Pt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){jt(i,n,o,a,c,"next",t)}function c(t){jt(i,n,o,a,c,"throw",t)}a(void 0)}))}}function _t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Nt(n.key),n)}}function Nt(t){var e=function(t){if("object"!=St(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=St(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==St(e)?e:e+""}var It=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.camera=null,this.map=new nt,this.presenter=new mt(this),this.boundSubmitHandler=this.handleFormSubmit.bind(this)},e=[{key:"render",value:(i=Pt(Ot().mark((function t(){return Ot().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n          <section class="container">\n            <h1>Add New Story</h1>\n            <form id="story-form">\n                <div class="input-form-group">\n                    <label for="description">Description</label>\n                    <textarea id="description" class="input-field" resize="none" required></textarea>\n                </div>\n\n                <div class="input-form-group">\n                    <label for="camera-input">Photo</label>\n                    <div class="camera-container">\n                        <select id="camera-select" class="camera-select">\n                            <option value="">Initializing camera...</option>\n                        </select>\n                        <div class="camera-preview-container">\n                            <div class="camera-preview-wrapper">\n                                <video id="camera-preview" autoplay playsinline></video>\n                                <button type="button" id="camera-capture" class="camera-button" disabled>Take Photo</button>\n                            </div>\n                            <div class="camera-result-wrapper">\n                                <img id="camera-result" style="display: none;">\n                            </div>\n                        </div>\n                        <canvas id="camera-canvas" style="display: none;"></canvas>\n                    </div>\n                </div>\n\n                <div class="input-form-group">\n                    <label for="map">Location</label>\n                    <div id="map" class="map-container" style="height: 400px;"></div>\n                    <p class="map-info">Click on the map to set location</p>\n                    <div class="location-inputs">\n                        <div class="input-group">\n                            <label for="latitude">Latitude</label>\n                            <input type="text" id="latitude" class="input-field" readonly>\n                        </div>\n                        <div class="input-group">\n                            <label for="longitude">Longitude</label>\n                            <input type="text" id="longitude" class="input-field" readonly>\n                        </div>\n                    </div>\n                </div>\n\n                <button type="submit" id="submit-button">Add Story</button>\n            </form>\n          </section>\n        ');case 1:case"end":return t.stop()}}),t)}))),function(){return i.apply(this,arguments)})},{key:"afterRender",value:(o=Pt(Ot().mark((function t(){var e,r=this;return Ot().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.camera=new kt,t.next=4,this.initializeCamera();case 4:this.map.initialize("map",{clickable:!0}),this.map.onMarkerChange((function(t){r.updateLocationInputs(t)})),(e=document.getElementById("story-form"))&&e.addEventListener("submit",this.boundSubmitHandler),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error("Error initializing story page:",t.t0),this.showError("Failed to initialize page. Please refresh and try again.");case 14:case"end":return t.stop()}}),t,this,[[0,10]])}))),function(){return o.apply(this,arguments)})},{key:"updateLocationInputs",value:function(t){var e=document.getElementById("latitude"),r=document.getElementById("longitude");t?(e.value=t.latitude.toFixed(6),r.value=t.longitude.toFixed(6)):(e.value="",r.value="")}},{key:"handleFormSubmit",value:(n=Pt(Ot().mark((function t(e){var r,n,o,i;return Ot().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),r=document.getElementById("description")){t.next=5;break}return this.showError("Form elements not found. Please refresh the page."),t.abrupt("return");case 5:if(n=r.value.trim()){t.next=9;break}return this.showError("Please fill in the description field."),t.abrupt("return");case 9:return t.prev=9,t.next=12,this.camera.getImageBlob();case 12:if(o=t.sent){t.next=16;break}return this.showError("Please take a photo first."),t.abrupt("return");case 16:return i=this.map.getMarkerLocation(),t.next=19,this.presenter.handleStorySubmit({description:n,imageBlob:o,latitude:null==i?void 0:i.latitude,longitude:null==i?void 0:i.longitude});case 19:t.next=25;break;case 21:t.prev=21,t.t0=t.catch(9),console.error("Error submitting story:",t.t0),this.showError("Error submitting story. Please try again.");case 25:case"end":return t.stop()}}),t,this,[[9,21]])}))),function(t){return n.apply(this,arguments)})},{key:"showError",value:function(t){alert(t)}},{key:"showSuccess",value:function(t){var e=document.createElement("div");e.className="notification notification-success",e.innerHTML='\n            <div class="notification-content">\n                <i class="fas fa-check-circle"></i>\n                <span>'.concat(t,'</span>\n                <button class="notification-close">&times;</button>\n            </div>\n        '),document.body.appendChild(e),setTimeout((function(){e.parentNode&&e.parentNode.removeChild(e)}),3e3),e.querySelector(".notification-close").addEventListener("click",(function(){e.parentNode&&e.parentNode.removeChild(e)}))}},{key:"showLoading",value:function(t){var e=document.getElementById("submit-button");e&&(e.disabled=t,e.textContent=t?"Adding Story...":"Add Story")}},{key:"initializeCamera",value:(r=Pt(Ot().mark((function t(){var e,r;return Ot().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!((e=["camera-preview","camera-canvas","camera-capture","camera-result","camera-select"].filter((function(t){return!document.getElementById(t)}))).length>0)){t.next=5;break}throw new Error("Missing camera elements: ".concat(e.join(", ")));case 5:return t.next=7,this.camera.initialize();case 7:(r=document.getElementById("camera-capture"))&&(r.disabled=!1),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(0),console.error("Error initializing camera:",t.t0),t.t0;case 15:case"end":return t.stop()}}),t,this,[[0,11]])}))),function(){return r.apply(this,arguments)})},{key:"cleanup",value:function(){var t=document.getElementById("story-form");t&&t.removeEventListener("submit",this.boundSubmitHandler),this.camera&&(this.camera.cleanup(),this.camera=null),this.resetCameraUI(),this.map&&this.map.cleanup(),this.presenter&&this.presenter.cleanup()}},{key:"resetCameraUI",value:function(){var t=document.getElementById("camera-preview"),e=document.getElementById("camera-result"),r=document.getElementById("camera-capture"),n=document.getElementById("camera-select");t&&(t.srcObject=null,t.pause()),e&&(e.src="",e.style.display="none"),r&&(r.disabled=!0),n&&(n.innerHTML='<option value="">Initializing camera...</option>')}}],e&&_t(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i}();function Tt(t){return Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tt(t)}function At(){At=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Tt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Tt(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ft(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Ct(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ft(i,n,o,a,c,"next",t)}function c(t){Ft(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Bt(n.key),n)}}function Bt(t){var e=function(t){if("object"!=Tt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Tt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Tt(e)?e:e+""}const Dt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.init()},e=[{key:"init",value:function(){var t=this;document.addEventListener("login",function(){var e=Ct(At().mark((function e(r){var n,o,i;return At().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.detail,o=n.email,i=n.password,e.next=3,t.handleLogin(o,i);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"handleLogin",value:(r=Ct(At().mark((function t(e,r){var n;return At().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.view.updateUIState(!0),t.next=4,F({email:e,password:r});case 4:(n=t.sent).loginResult&&n.loginResult.token?this.view.handleLoginSuccess():this.view.handleLoginError("Login failed. Please check your credentials."),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),this.view.handleLoginError(t.t0.message||"An error occurred during login.");case 11:return t.prev=11,this.view.updateUIState(!1),t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[0,8,11,14]])}))),function(t,e){return r.apply(this,arguments)})}],e&&Gt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();function Mt(t){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mt(t)}function Rt(){Rt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Mt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Mt(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ut(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Yt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ut(i,n,o,a,c,"next",t)}function c(t){Ut(i,n,o,a,c,"throw",t)}a(void 0)}))}}function zt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ht(n.key),n)}}function Ht(t){var e=function(t){if("object"!=Mt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Mt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Mt(e)?e:e+""}var qt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.presenter=new Dt(this)},e=[{key:"render",value:(n=Yt(Rt().mark((function t(){return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n            <div class="login-container">\n                <h1>Login</h1>\n                <form id="login-form">\n                    <div class="input-form-group">\n                        <label for="email">Email</label>\n                        <input type="email" name="email" id="email" class="input-field" placeholder="john_doe@example.com" required>\n                    </div>\n                    <div class="input-form-group">\n                        <label for="password">Password</label>\n                        <input type="password" name="password" id="password" class="input-field" placeholder="********" required>\n                    </div>\n                    <button type="submit">Login</button>\n                    <p>Don\'t have an account? <a href="#/register">Register</a></p>\n                </form>\n            </div>\n        ');case 1:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"afterRender",value:(r=Yt(Rt().mark((function t(){return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:document.getElementById("login-form").addEventListener("submit",function(){var t=Yt(Rt().mark((function t(e){var r,n,o;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),r=document.getElementById("email").value,n=document.getElementById("password").value,o=new CustomEvent("login",{detail:{email:r,password:n}}),document.dispatchEvent(o);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})},{key:"updateUIState",value:function(t){var e=document.querySelector('#login-form button[type="submit"]');e&&(e.disabled=t,e.textContent=t?"Logging in...":"Login")}},{key:"handleLoginSuccess",value:function(){document.body.classList.remove("auth-page");var t=document.querySelector(".footer");t&&(t.classList.remove("hidden"),t.style.opacity="1",t.style.transform="translateY(0)"),window.location.href="#/"}},{key:"handleLoginError",value:function(t){var e=document.createElement("div");e.className="error-message",e.textContent=t;var r=document.getElementById("login-form"),n=r.querySelector(".error-message");n&&n.remove(),r.insertBefore(e,r.firstChild),setTimeout((function(){e.remove()}),3e3)}}],e&&zt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function Wt(t){return Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wt(t)}function Vt(){Vt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Wt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Wt(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Jt(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Kt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Jt(i,n,o,a,c,"next",t)}function c(t){Jt(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Zt(n.key),n)}}function Zt(t){var e=function(t){if("object"!=Wt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Wt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Wt(e)?e:e+""}const $t=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.init()},e=[{key:"init",value:function(){var t=this;document.addEventListener("register",function(){var e=Kt(Vt().mark((function e(r){var n,o,i,a,c;return Vt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.detail,o=n.name,i=n.email,a=n.password,c=n.confirmPassword,e.next=3,t.handleRegister(o,i,a,c);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"handleRegister",value:(r=Kt(Vt().mark((function t(e,r,n,o){var i;return Vt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n===o){t.next=4;break}return this.view.handleRegisterError("Passwords do not match!"),t.abrupt("return");case 4:return this.view.updateUIState(!0),t.next=7,T({name:e,email:r,password:n});case 7:(i=t.sent).ok?this.view.handleRegisterSuccess():this.view.handleRegisterError(i.message||"Registration failed. Please try again."),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),this.view.handleRegisterError(t.t0.message||"An error occurred during registration.");case 14:return t.prev=14,this.view.updateUIState(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[0,11,14,17]])}))),function(t,e,n,o){return r.apply(this,arguments)})}],e&&Xt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();function Qt(t){return Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qt(t)}function te(){te=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Qt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Qt(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ee(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function re(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ee(i,n,o,a,c,"next",t)}function c(t){ee(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,oe(n.key),n)}}function oe(t){var e=function(t){if("object"!=Qt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Qt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Qt(e)?e:e+""}var ie=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.presenter=new $t(this)},e=[{key:"render",value:(n=re(te().mark((function t(){return te().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n            <div class="register-container">\n                <h1>Register</h1>\n                <form id="register-form">\n                    <div class="input-form-group">\n                        <label for="username">Username</label>\n                        <input type="text" name="username" id="username" class="input-field" placeholder="john_doe" required>\n                    </div>\n                    <div class="input-form-group">\n                        <label for="email">Email</label>\n                        <input type="email" name="email" id="email" class="input-field" placeholder="john_doe@example.com" required>\n                    </div>\n                    <div class="input-form-group">\n                        <label for="password">Password</label>\n                        <input type="password" name="password" id="password" class="input-field" placeholder="********" required>\n                    </div>\n                    <div class="input-form-group">\n                        <label for="confirm-password">Confirm Password</label>\n                        <input type="password" name="confirm-password" id="confirm-password" class="input-field" placeholder="********" required>\n                    </div>\n                    <button type="submit">Register</button>\n                    <p>Already have an account? <a href="#/login">Login</a></p>\n                </form>\n            </div>\n        ');case 1:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"afterRender",value:(r=re(te().mark((function t(){return te().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:document.getElementById("register-form").addEventListener("submit",function(){var t=re(te().mark((function t(e){var r,n,o,i,a;return te().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),r=document.getElementById("username").value,n=document.getElementById("email").value,o=document.getElementById("password").value,i=document.getElementById("confirm-password").value,a=new CustomEvent("register",{detail:{name:r,email:n,password:o,confirmPassword:i}}),document.dispatchEvent(a);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})},{key:"updateUIState",value:function(t){var e=document.querySelector('#register-form button[type="submit"]');e&&(e.disabled=t,e.textContent=t?"Registering...":"Register")}},{key:"handleRegisterSuccess",value:function(){var t=document.createElement("div");t.className="success-message",t.textContent="Registration successful! Please login.";var e=document.getElementById("register-form");e.insertBefore(t,e.firstChild),setTimeout((function(){document.body.classList.remove("auth-page");var t=document.querySelector(".footer");t&&(t.classList.remove("hidden"),t.style.opacity="1",t.style.transform="translateY(0)"),window.location.href="#/login"}),2e3)}},{key:"handleRegisterError",value:function(t){var e=document.createElement("div");e.className="error-message",e.textContent=t;var r=document.getElementById("register-form"),n=r.querySelector(".error-message");n&&n.remove(),r.insertBefore(e,r.firstChild),setTimeout((function(){e.remove()}),3e3)}}],e&&ne(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function ae(t){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ae(t)}function ce(){ce=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==ae(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ae(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function se(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function ue(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){se(i,n,o,a,c,"next",t)}function c(t){se(i,n,o,a,c,"throw",t)}a(void 0)}))}}function le(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,fe(n.key),n)}}function fe(t){var e=function(t){if("object"!=ae(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ae(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ae(e)?e:e+""}var he=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"render",value:(n=ue(ce().mark((function t(){return ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <section class="container">\n        <h1>About Page</h1>\n      </section>\n    ');case 1:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"afterRender",value:(r=ue(ce().mark((function t(){return ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}],e&&le(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function pe(t){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pe(t)}function de(){de=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==pe(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(pe(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ye(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function ve(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,me(n.key),n)}}function me(t){var e=function(t){if("object"!=pe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pe(e)?e:e+""}var ge=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.map=r,this.story=null},e=[{key:"loadStoryDetail",value:(r=de().mark((function t(e){var r;return de().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.view.showLoading(),t.next=4,z(e);case 4:r=t.sent,this.story=r.story,this.view.updateStoryDetail(this.story),this.story.lat&&this.story.lon&&this.initializeMap(),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error("Error loading story details:",t.t0),this.view.showError(t.t0.message);case 14:case"end":return t.stop()}}),t,this,[[0,10]])})),n=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){ye(i,n,o,a,c,"next",t)}function c(t){ye(i,n,o,a,c,"throw",t)}a(void 0)}))},function(t){return n.apply(this,arguments)})},{key:"initializeMap",value:function(){this.map.initialize("story-detail-map",{center:[this.story.lat,this.story.lon],zoom:10,clickable:!1}),this.map.setMarkerLocation(this.story.lat,this.story.lon,'\n        <div class="story-popup">\n          <h3>'.concat(this.story.name,"</h3>\n          <p>").concat(this.story.description,"</p>\n          <p><small>Posted on: ").concat(new Date(this.story.createdAt).toLocaleDateString(),"</small></p>\n        </div>\n      ")),this.map.map.setView([this.story.lat,this.story.lon],10)}}],e&&ve(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();const we=ge;function be(t){return be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},be(t)}function xe(){xe=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==be(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(be(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ee(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Le(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ee(i,n,o,a,c,"next",t)}function c(t){Ee(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ke(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Se(n.key),n)}}function Se(t){var e=function(t){if("object"!=be(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=be(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==be(e)?e:e+""}var Oe=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.map=new nt,this.presenter=new we(this,this.map)},e=[{key:"render",value:(n=Le(xe().mark((function t(){return xe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <section class="container">\n        <div class="story-detail-section">\n          <div class="story-detail-header">\n            <a href="#/" class="back-button">\n              <i class="fas fa-arrow-left"></i> Back to Stories\n            </a>\n          </div>\n          \n          <div id="story-detail-content">\n            <div class="loader-container">\n              <div class="loader"></div>\n              <div class="loader-text">Loading story details...</div>\n            </div>\n          </div>\n        </div>\n      </section>\n    ');case 1:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"afterRender",value:(r=Le(xe().mark((function t(){var e,r;return xe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=new URLSearchParams(window.location.hash.split("?")[1]),r=e.get("id")){t.next=6;break}return this.showError("Story ID not found"),t.abrupt("return");case 6:return t.next=8,this.presenter.loadStoryDetail(r);case 8:t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error("Error loading story details:",t.t0),this.showError(t.t0.message);case 14:case"end":return t.stop()}}),t,this,[[0,10]])}))),function(){return r.apply(this,arguments)})},{key:"updateStoryDetail",value:function(t){var e=document.getElementById("story-detail-content"),r=new Date(t.createdAt).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});e.innerHTML='\n      <div class="story-detail">\n        <div class="story-detail-image">\n          <img src="'.concat(t.photoUrl,'" alt="').concat(t.name,'\' story" loading="lazy">\n        </div>\n        \n        <div class="story-detail-content">\n          <div class="story-detail-header">\n            <h1 class="story-detail-title">').concat(t.name,'</h1>\n            <div class="story-detail-meta">\n              <span class="story-detail-author">\n                <i class="fas fa-user"></i>\n                Posted by: ').concat(t.name,'\n              </span>\n              <span class="story-detail-date">\n                <i class="fas fa-calendar"></i>\n                Posted on: ').concat(r,'\n              </span>\n            </div>\n          </div>\n\n          <div class="story-detail-description">\n            <h2>Description</h2>\n            <p>').concat(t.description,"</p>\n          </div>\n\n          ").concat(t.lat&&t.lon?'\n            <div class="story-detail-location">\n              <h2>Location Details</h2>\n              <div class="location-coordinates">\n                <div class="coordinate">\n                  <i class="fas fa-map-marker-alt"></i>\n                  <span>Latitude: '.concat(t.lat,'</span>\n                </div>\n                <div class="coordinate">\n                  <i class="fas fa-map-marker-alt"></i>\n                  <span>Longitude: ').concat(t.lon,"</span>\n                </div>\n              </div>\n            </div>\n          "):"","\n        </div>\n\n        ").concat(t.lat&&t.lon?'\n          <div class="story-detail-map-container">\n            <h2>Story Location</h2>\n            <div id="story-detail-map" style="height: 400px;"></div>\n          </div>\n        ':"","\n      </div>\n    ")}},{key:"showLoading",value:function(){document.getElementById("story-detail-content").innerHTML='\n      <div class="loader-container">\n        <div class="loader"></div>\n        <div class="loader-text">Loading story details...</div>\n      </div>\n    '}},{key:"showError",value:function(t){document.getElementById("story-detail-content").innerHTML='\n      <div class="error-state">\n        <p>Error: '.concat(t,'</p>\n        <a href="#/" class="btn primary">Back to Home</a>\n      </div>\n    ')}},{key:"cleanup",value:function(){this.map&&this.map.cleanup()}}],e&&ke(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function je(t){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},je(t)}function Pe(){Pe=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==je(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(je(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function _e(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Ne(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){_e(i,n,o,a,c,"next",t)}function c(t){_e(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Ie(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Te(n.key),n)}}function Te(t){var e=function(t){if("object"!=je(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==je(e)?e:e+""}const Ae=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.currentPath=window.location.hash.slice(1)||"/"},e=[{key:"render",value:(n=Ne(Pe().mark((function t(){return Pe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <div class="not-found-page">\n        <div class="container">\n          <div class="not-found-content">\n            <div class="not-found-icon">\n              <i class="fas fa-exclamation-triangle"></i>\n            </div>\n            \n            <h1 class="not-found-title">404</h1>\n            <h2 class="not-found-subtitle">Page Not Found</h2>\n            \n            <p class="not-found-description">\n              Oops! The page you\'re looking for doesn\'t exist.\n            </p>\n            \n            <div class="not-found-details">\n              <p><strong>Requested URL:</strong> <code>'.concat(this.currentPath,'</code></p>\n              <p>This page might have been moved, deleted, or you entered the wrong URL.</p>\n            </div>\n            \n            <div class="not-found-actions">\n              <a href="#/" class="btn btn-primary">\n                <i class="fas fa-home"></i>\n                Go to Home\n              </a>\n              <button onclick="history.back()" class="btn btn-secondary">\n                <i class="fas fa-arrow-left"></i>\n                Go Back\n              </button>\n            </div>\n            \n            <div class="not-found-suggestions">\n              <h3>You might want to try:</h3>\n              <ul>\n                <li><a href="#/">Home Page</a></li>\n                <li><a href="#/about">About</a></li>\n                <li><a href="#/story/add">Add Story</a></li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </div>\n    '));case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"afterRender",value:(r=Ne(Pe().mark((function t(){return Pe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.setupEventListeners();case 1:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"setupEventListeners",value:function(){}},{key:"cleanup",value:function(){}}],e&&Ie(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function Fe(t){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fe(t)}function Ce(){Ce=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Fe(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Fe(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ge(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Be(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ge(i,n,o,a,c,"next",t)}function c(t){Ge(i,n,o,a,c,"throw",t)}a(void 0)}))}}var De=function(t){return{render:(r=Be(Ce().mark((function e(){return Ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q()){e.next=3;break}return window.location.href="#/login",e.abrupt("return","");case 3:return e.next=5,t.render();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)}),afterRender:(e=Be(Ce().mark((function e(){return Ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!q()){e.next=3;break}return e.next=3,t.afterRender();case 3:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})};var e,r},Me=function(t){return{render:(r=Be(Ce().mark((function e(){return Ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!q()){e.next=3;break}return window.location.href="#/",e.abrupt("return","");case 3:return e.next=5,t.render();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)}),afterRender:(e=Be(Ce().mark((function e(){return Ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q()){e.next=3;break}return e.next=3,t.afterRender();case 3:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})};var e,r},Re={"/":De(new lt),"/login":Me(new qt),"/register":Me(new ie),"/about":De(new he),"/story/add":De(new It),"/detail":De(new Oe)},Ue=function(t){return Re[t]||{render:(r=Be(Ce().mark((function t(){var e;return Ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new Ae,t.next=3,e.render();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)}),afterRender:(e=Be(Ce().mark((function t(){var e;return Ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new Ae,t.next=3,e.afterRender();case 3:case"end":return t.stop()}}),t)}))),function(){return e.apply(this,arguments)})};var e,r};function Ye(t){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ye(t)}function ze(){ze=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Ye(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ye(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function He(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],s=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return qe(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qe(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qe(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function We(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Ve(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){We(i,n,o,a,c,"next",t)}function c(t){We(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Je(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ke(n.key),n)}}function Ke(t){var e=function(t){if("object"!=Ye(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Ye(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ye(e)?e:e+""}const Xe=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._init(),this._currentPage=null},e=[{key:"_init",value:function(){var t=this;this._updateHeader(),window.addEventListener("hashchange",(function(){t._currentPage&&"function"==typeof t._currentPage.cleanup&&t._currentPage.cleanup(),t._updateHeader(),t._renderPage()})),this._setupSkipToContent(),this._renderPage()}},{key:"_setupSkipToContent",value:function(){var t=document.querySelector(".skip-to-content");if(t){var e=function(t){t.preventDefault();var e=document.querySelector("#main-content");e&&(e.tabIndex=-1,e.focus(),e.scrollIntoView({behavior:"smooth"}),setTimeout((function(){e.removeAttribute("tabIndex")}),1e3))};t.addEventListener("click",e),t.addEventListener("keydown",(function(t){"Enter"!==t.key&&" "!==t.key||e(t)}))}}},{key:"_updateHeader",value:function(){var t,e,r,n,o,i;document.querySelector("header").innerHTML=(t=q(),e=window.location.hash.slice(1)||"/",'\n    <header class="app-header">\n      <div class="main-header container">\n        <a class="brand-name" href="#/">Story App</a>\n        <nav id="navigation-drawer" class="navigation-drawer">\n          <ul id="nav-list" class="nav-list">\n            '.concat(function(t,e){return"/login"===e||"/register"===e?'\n      <li><a href="#/login" class="'.concat("/login"===e?"active":"",'">Login</a></li>\n      <li><a href="#/register" class="').concat("/register"===e?"active":"",'">Register</a></li>\n    '):t?'\n      <li><a href="#/" class="'.concat("/"===e?"active":"",'">Home</a></li>\n      <li><a href="#/about" class="').concat("/about"===e?"active":"",'">About</a></li>\n      <li><a href="#/story/add" class="').concat("/story/add"===e?"active":"",'">Add Story</a></li>\n      <li><a href="#/logout" id="logout-link" class="nav-link">Logout</a></li>\n    '):'\n    <li><a href="#/login">Login</a></li>\n    <li><a href="#/register">Register</a></li>\n  '}(t,e),'\n          </ul>\n        </nav>\n        <div class="header-controls">\n          ').concat(t?'\n            <button id="notification-toggle" class="notification-toggle" title="Toggle Notifications">\n              <i class="fas fa-bell"></i>\n            </button>\n          ':"",'\n          <button id="drawer-button" class="drawer-button" aria-label="Toggle navigation menu">‚ò∞</button>\n        </div>\n      </div>\n    </header>\n  ')),r=document.getElementById("drawer-button"),n=document.getElementById("navigation-drawer"),o=document.getElementById("logout-link"),document.getElementById("notification-toggle"),i=window.matchMedia("(display-mode: standalone)").matches||window.matchMedia("(display-mode: window-controls-overlay)").matches||window.matchMedia("(display-mode: minimal-ui)").matches||!0===window.navigator.standalone,"function"==typeof window.setupNotificationToggle&&window.setupNotificationToggle(),r&&r.addEventListener("click",(function(){n.classList.toggle("open"),i&&(n.classList.contains("open")?document.body.style.overflow="hidden":document.body.style.overflow="")})),o&&o.addEventListener("click",(function(t){t.preventDefault(),localStorage.removeItem("token"),localStorage.removeItem("user"),I(),window.location.href="#/login"})),document.addEventListener("click",(function(t){!n||n.contains(t.target)||r.contains(t.target)||(n.classList.remove("open"),i&&(document.body.style.overflow=""))})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&n&&n.classList.contains("open")&&(n.classList.remove("open"),i&&(document.body.style.overflow=""))})),i&&window.addEventListener("hashchange",(function(){n&&n.classList.contains("open")&&(n.classList.remove("open"),document.body.style.overflow="")}))}},{key:"_toggleFooter",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=document.querySelector(".footer"),r=document.body;e&&(t?(e.classList.remove("hidden"),r.classList.remove("auth-page")):(e.classList.add("hidden"),r.classList.add("auth-page")))}},{key:"_shouldHideFooter",value:function(t){return"/login"===t||"/register"===t}},{key:"_renderPage",value:(r=Ve(ze().mark((function t(){var e,r,n,o,i,a,c,s,u,l,f=this;return ze().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=document.querySelector("#main-content"),r=window.location.hash.slice(1),n=r.split("?"),o=He(n,2),i=o[0],o[1],c=Ue(a=i||"/"),s=this._currentPage&&("LoginPage"===this._currentPage.constructor.name||"RegisterPage"===this._currentPage.constructor.name)&&"/"===a,t.prev=6,!s){t.next=25;break}return document.body.classList.remove("auth-page"),(u=document.querySelector(".footer"))&&(u.classList.remove("hidden"),u.style.opacity="1",u.style.transform="translateY(0)"),t.next=13,c.render();case 13:return e.innerHTML=t.sent,this._currentPage=c,t.next=17,c.afterRender();case 17:return e.style.opacity="0",e.style.transform="translateY(20px)",e.offsetHeight,e.style.transition="opacity 0.4s ease, transform 0.4s ease",e.style.opacity="1",e.style.transform="translateY(0)",setTimeout((function(){e.style.transition="",e.style.opacity="",e.style.transform=""}),400),t.abrupt("return");case 25:if(e.innerHTML='\n    <div class="loader-container" id="global-loader">\n      <div class="loader"></div>\n      <div class="loader-text">Loading...</div>\n    </div>',!document.startViewTransition){t.next=32;break}return l=document.startViewTransition(Ve(ze().mark((function t(){return ze().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.render();case 2:return e.innerHTML=t.sent,f._currentPage=c,t.next=6,c.afterRender();case 6:f._toggleFooter(!f._shouldHideFooter(a));case 7:case"end":return t.stop()}}),t)})))),t.next=30,l.finished;case 30:t.next=39;break;case 32:return t.next=34,c.render();case 34:return e.innerHTML=t.sent,this._currentPage=c,t.next=38,c.afterRender();case 38:this._toggleFooter(!this._shouldHideFooter(a));case 39:t.next=45;break;case 41:t.prev=41,t.t0=t.catch(6),console.error("Error rendering page:",t.t0),e.innerHTML="<h1>Error loading page</h1>";case 45:case"end":return t.stop()}}),t,this,[[6,41]])}))),function(){return r.apply(this,arguments)})}],e&&Je(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();var Ze,$e=r(275);function Qe(t){return Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qe(t)}function tr(){tr=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Qe(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Qe(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function er(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function rr(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){er(i,n,o,a,c,"next",t)}function c(t){er(i,n,o,a,c,"throw",t)}a(void 0)}))}}var nr=null,or=function(){nr&&(nr.remove(),nr=null)};function ir(t){return ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ir(t)}function ar(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,cr(n.key),n)}}function cr(t){var e=function(t){if("object"!=ir(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ir(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ir(e)?e:e+""}const sr=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.statusIndicator=null,this.init()},(e=[{key:"init",value:function(){var t=this;this.createStatusIndicator(),window.addEventListener("online",(function(){return t.updateStatus(!0)})),window.addEventListener("offline",(function(){return t.updateStatus(!1)})),this.updateStatus(navigator.onLine)}},{key:"createStatusIndicator",value:function(){this.statusIndicator=document.createElement("div"),this.statusIndicator.className="network-status",this.statusIndicator.innerHTML='\n            <div class="network-status-content">\n                <i class="fas fa-wifi"></i>\n                <span class="network-status-text">Online</span>\n            </div>\n        ',document.body.appendChild(this.statusIndicator)}},{key:"updateStatus",value:function(t){var e=this;if(this.statusIndicator){var r=this.statusIndicator.querySelector("i"),n=this.statusIndicator.querySelector(".network-status-text");t?(this.statusIndicator.className="network-status network-status-online",r.className="fas fa-wifi",n.textContent="Online",setTimeout((function(){e.statusIndicator.classList.add("network-status-hidden")}),3e3)):(this.statusIndicator.className="network-status network-status-offline",r.className="fas fa-wifi-slash",n.textContent="Offline",this.statusIndicator.classList.remove("network-status-hidden"))}}},{key:"destroy",value:function(){this.statusIndicator&&this.statusIndicator.parentNode&&this.statusIndicator.parentNode.removeChild(this.statusIndicator)}}])&&ar(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ur(t){return ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ur(t)}function lr(){lr=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new N(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function w(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=m.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==ur(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ur(e)+" is not iterable")}return g.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function fr(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function hr(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){fr(i,n,o,a,c,"next",t)}function c(t){fr(i,n,o,a,c,"throw",t)}a(void 0)}))}}var pr=new Xe;function dr(){var t=document.createElement("div");t.className="sync-notification",t.innerHTML='\n    <div class="sync-content">\n      <p>üîÑ Syncing offline stories...</p>\n    </div>\n  ',t.style.cssText="\n    position: fixed;\n    top: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    z-index: 1000;\n    padding: 15px 20px;\n    background-color: #2196F3;\n    color: white;\n    border-radius: 5px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n    font-size: 14px;\n  ",document.body.appendChild(t),setTimeout((function(){t.parentNode&&t.parentNode.removeChild(t)}),3e3)}function yr(t){var e=document.createElement("div");e.className="sync-success-notification",e.innerHTML='\n    <div class="sync-content">\n      <p>‚úÖ Successfully synced '.concat(t," story(ies) to server!</p>\n    </div>\n  "),e.style.cssText="\n    position: fixed;\n    top: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    z-index: 1000;\n    padding: 15px 20px;\n    background-color: #4CAF50;\n    color: white;\n    border-radius: 5px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n    font-size: 14px;\n  ",document.body.appendChild(e),setTimeout((function(){e.parentNode&&e.parentNode.removeChild(e)}),5e3)}function vr(){var t=document.createElement("div");t.className="sync-error-notification",t.innerHTML='\n    <div class="sync-content">\n      <p>‚ùå Failed to sync offline stories. Will retry later.</p>\n    </div>\n  ',t.style.cssText="\n    position: fixed;\n    top: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    z-index: 1000;\n    padding: 15px 20px;\n    background-color: #f44336;\n    color: white;\n    border-radius: 5px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n    font-size: 14px;\n  ",document.body.appendChild(t),setTimeout((function(){t.parentNode&&t.parentNode.removeChild(t)}),5e3)}function mr(){if("granted"!==Notification.permission)if("Notification"in window){var t=document.createElement("button");t.textContent="üîî Enable Notifications",t.className="notification-permission-btn",t.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    z-index: 1000;\n    padding: 10px 15px;\n    background-color: #4CAF50;\n    color: white;\n    border: none;\n    border-radius: 5px;\n    cursor: pointer;\n    font-size: 14px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n    transition: background-color 0.3s ease;\n  ",t.addEventListener("mouseenter",(function(){t.style.backgroundColor="#45a049"})),t.addEventListener("mouseleave",(function(){t.style.backgroundColor="#4CAF50"})),t.addEventListener("click",hr(lr().mark((function e(){var r;return lr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.disabled=!0,t.textContent="‚è≥ Requesting...",e.next=5,(0,$e.requestNotificationPermission)();case 5:if(!e.sent){e.next=18;break}return console.log("Notification permission granted"),t.textContent="‚úÖ Notifications Enabled",t.style.backgroundColor="#45a049",e.next=12,navigator.serviceWorker.ready;case 12:return r=e.sent,e.next=15,(0,$e.subscribeToPushNotifications)(r);case 15:setTimeout((function(){t.parentNode&&t.parentNode.removeChild(t)}),3e3),e.next=22;break;case 18:console.log("Notification permission denied"),t.textContent="‚ùå Permission Denied",t.style.backgroundColor="#f44336",setTimeout((function(){t.disabled=!1,t.textContent="üîî Enable Notifications",t.style.backgroundColor="#4CAF50"}),3e3);case 22:e.next=30;break;case 24:e.prev=24,e.t0=e.catch(0),console.error("Failed to request notification permission:",e.t0),t.textContent="‚ùå Error",t.style.backgroundColor="#f44336",setTimeout((function(){t.disabled=!1,t.textContent="üîî Enable Notifications",t.style.backgroundColor="#4CAF50"}),3e3);case 30:case"end":return e.stop()}}),e,null,[[0,24]])})))),document.body.appendChild(t)}else console.log("Notifications not supported");else console.log("Notification permission already granted")}function gr(){var t=document.createElement("div");t.className="pwa-debug-status";var e=function(){var e=window.matchMedia("(display-mode: standalone)").matches||window.matchMedia("(display-mode: window-controls-overlay)").matches||window.matchMedia("(display-mode: minimal-ui)").matches||!0===window.navigator.standalone;t.innerHTML="\n      <div>üì± PWA: ".concat(e?"YES":"NO","</div>\n      <div>üåê Online: ").concat(navigator.onLine?"YES":"NO","</div>\n      <div>üîß Dev: ").concat("localhost"===window.location.hostname?"YES":"NO","</div>\n    ")};e(),document.body.appendChild(t),window.addEventListener("online",e),window.addEventListener("offline",e)}function wr(){return br.apply(this,arguments)}function br(){return br=hr(lr().mark((function t(){var e,r,n,o,i,a,c;return lr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.serviceWorker.getRegistration();case 3:if(e=t.sent,r=!!e,n="indexedDB"in window,o=!1,!n){t.next=19;break}return t.prev=8,i=new y,t.next=12,i.getCacheStats();case 12:a=t.sent,o=a.total>0,t.next=19;break;case 16:t.prev=16,t.t0=t.catch(8),console.warn("Failed to check cached data:",t.t0);case 19:return c=window.matchMedia("(display-mode: standalone)").matches||window.matchMedia("(display-mode: window-controls-overlay)").matches||window.matchMedia("(display-mode: minimal-ui)").matches||!0===window.navigator.standalone,console.log("üì± Offline Capabilities Check:",{hasServiceWorker:r,hasIndexedDB:n,hasCachedData:o,isPWA:c,isOnline:navigator.onLine}),"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||xr({hasServiceWorker:r,hasIndexedDB:n,hasCachedData:o,isPWA:c,isOnline:navigator.onLine}),t.abrupt("return",{hasServiceWorker:r,hasIndexedDB:n,hasCachedData:o,isPWA:c,isOnline:navigator.onLine});case 25:return t.prev=25,t.t1=t.catch(0),console.error("Failed to check offline capabilities:",t.t1),t.abrupt("return",{hasServiceWorker:!1,hasIndexedDB:!1,hasCachedData:!1,isPWA:!1,isOnline:navigator.onLine});case 29:case"end":return t.stop()}}),t,null,[[0,25],[8,16]])}))),br.apply(this,arguments)}function xr(t){var e=document.querySelector(".offline-capabilities-status");e&&e.remove();var r=document.createElement("div");r.className="offline-capabilities-status",r.style.cssText="\n    position: fixed;\n    bottom: 10px;\n    right: 10px;\n    background: rgba(0, 0, 0, 0.9);\n    color: white;\n    padding: 15px;\n    border-radius: 8px;\n    font-size: 12px;\n    z-index: 9999;\n    font-family: monospace;\n    max-width: 300px;\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n  ";var n=function(t){return t?"‚úÖ":"‚ùå"};r.innerHTML='\n    <div style="margin-bottom: 8px; font-weight: bold; color: #4CAF50;">Offline Status</div>\n    <div>üåê Online: '.concat(n(t.isOnline),"</div>\n    <div>üì± PWA: ").concat(n(t.isPWA),"</div>\n    <div>üîß SW: ").concat(n(t.hasServiceWorker),"</div>\n    <div>üíæ IndexedDB: ").concat(n(t.hasIndexedDB),"</div>\n    <div>üì¶ Cached: ").concat(n(t.hasCachedData),"</div>\n  "),document.body.appendChild(r),setTimeout((function(){r.parentNode&&r.parentNode.removeChild(r)}),1e4)}function Er(){var t=document.getElementById("notification-toggle");t&&(Lr(),t.addEventListener("click",hr(lr().mark((function t(){var e;return lr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"default"!==Notification.permission){t.next=15;break}return t.next=4,Notification.requestPermission();case 4:if(e=t.sent,Lr(),"granted"!==e){t.next=12;break}return kr("Notifications enabled!","success"),t.next=10,(0,$e.subscribeToPushNotifications)();case 10:t.next=13;break;case 12:kr("Notifications disabled","error");case 13:t.next=16;break;case 15:"granted"===Notification.permission?kr("Notifications disabled","info"):kr("Please enable notifications in browser settings","info");case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(0),console.error("Error toggling notifications:",t.t0),kr("Failed to toggle notifications","error");case 22:case"end":return t.stop()}}),t,null,[[0,18]])})))))}function Lr(){var t=document.getElementById("notification-toggle");if(t){var e=t.querySelector("i");switch(Notification.permission){case"granted":t.classList.add("active"),t.classList.remove("disabled"),e.className="fas fa-bell",t.title="Notifications enabled (click to disable)";break;case"denied":t.classList.remove("active"),t.classList.add("disabled"),e.className="fas fa-bell-slash",t.title="Notifications blocked (enable in settings)";break;default:t.classList.remove("active","disabled"),e.className="fas fa-bell",t.title="Click to enable notifications"}}}function kr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=document.createElement("div");r.className="notification notification-".concat(e),r.innerHTML='\n    <div class="notification-content">\n      <i class="fas fa-'.concat("success"===e?"check-circle":"error"===e?"exclamation-circle":"info-circle",'"></i>\n      <span>').concat(t,'</span>\n      <button class="notification-close">&times;</button>\n    </div>\n  '),document.body.appendChild(r),setTimeout((function(){r.parentNode&&r.parentNode.removeChild(r)}),3e3);var n=r.querySelector(".notification-close");n&&n.addEventListener("click",(function(){r.parentNode&&r.parentNode.removeChild(r)}))}document.addEventListener("DOMContentLoaded",hr(lr().mark((function t(){var e;return lr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pr._renderPage(),e=window.matchMedia("(display-mode: standalone)").matches||window.matchMedia("(display-mode: window-controls-overlay)").matches||window.matchMedia("(display-mode: minimal-ui)").matches||!0===window.navigator.standalone,console.log("üöÄ App initialized - PWA Mode: ".concat(e,", Online: ").concat(navigator.onLine)),!e||"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||gr(),t.prev=4,t.next=7,(0,$e.registerServiceWorker)();case 7:t.sent&&console.log("Service Worker registered successfully"),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),console.error("Failed to register service worker:",t.t0);case 14:return window.addEventListener("beforeinstallprompt",(function(t){t.preventDefault(),Ze=t,setTimeout((function(){!nr&&Ze&&((nr=document.createElement("div")).className="pwa-install-prompt",nr.innerHTML='\n    <div class="pwa-install-content">\n      <h4>Install Story App</h4>\n      <p>Add this app to your home screen for quick and easy access when you\'re on the go.</p>\n      <div class="pwa-install-actions">\n        <button class="btn-secondary" id="pwa-dismiss">Not now</button>\n        <button class="btn-primary" id="pwa-install">Install</button>\n      </div>\n    </div>\n  ',document.body.appendChild(nr),document.getElementById("pwa-install").addEventListener("click",rr(tr().mark((function t(){return tr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Ze){t.next=8;break}return Ze.prompt(),t.next=4,Ze.userChoice;case 4:"accepted"===t.sent.outcome?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt"),Ze=null;case 8:or();case 9:case"end":return t.stop()}}),t)})))),document.getElementById("pwa-dismiss").addEventListener("click",(function(){or(),localStorage.setItem("pwa-install-dismissed",Date.now().toString())})))}),3e3)})),window.addEventListener("appinstalled",(function(){console.log("PWA was installed"),or(),Ze=null})),new sr,mr(),Er(),window.setupNotificationToggle=Er,window.addEventListener("online",hr(lr().mark((function t(){var e;return lr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Network connection restored"),dr(),t.prev=2,t.next=5,M();case 5:(e=t.sent).synced>0&&(yr(e.synced),setTimeout((function(){window.location.reload()}),2e3)),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(2),console.error("Failed to sync offline stories:",t.t0),vr();case 13:case"end":return t.stop()}}),t,null,[[2,9]])})))),window.addEventListener("offline",(function(){var t;console.log("Network connection lost"),(t=document.createElement("div")).className="offline-notification",t.innerHTML='\n    <div class="sync-content">\n      <p>üì± You\'re offline. Stories will be saved locally and synced when online.</p>\n    </div>\n  ',t.style.cssText="\n    position: fixed;\n    top: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    z-index: 1000;\n    padding: 15px 20px;\n    background-color: #FF9800;\n    color: white;\n    border-radius: 5px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n    font-size: 14px;\n  ",document.body.appendChild(t),setTimeout((function(){t.parentNode&&t.parentNode.removeChild(t)}),5e3)})),t.next=22,wr();case 22:case"end":return t.stop()}}),t,null,[[4,11]])})))),window.addEventListener("hashchange",(function(){pr._renderPage()}))})();